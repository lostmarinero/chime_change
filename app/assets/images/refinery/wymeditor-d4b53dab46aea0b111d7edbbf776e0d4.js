function titleize(e){return e==null?e:(parts=[],$.each(e.replace(/\./,"").replace(/[-_]/," ").split(" "),function(e,t){parts.push(t.substring(0,1).toUpperCase()+t.substring(1))}),parts.join(" "))}if(!WYMeditor)var WYMeditor={};(function(){if(!window.console||!console.firebug){var e=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];WYMeditor.console={};for(var t=0;t<e.length;++t)WYMeditor.console[e[t]]=function(){}}else WYMeditor.console=window.console})(),$.extend(WYMeditor,{VERSION:"0.5-rc1-refinery",INSTANCES:[],STRINGS:[],SKINS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",CSS_PATH:"{Wym_Css_Path}",WYM_PATH:"{Wym_Wym_Path}",SKINS_DEFAULT_PATH:"/assets/wymeditor/skins/",SKINS_DEFAULT_CSS:"skin.css",SKINS_DEFAULT_JS:"skin.js",LANG_DEFAULT_PATH:"lang/",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",TARGET:"target",ALT:"alt",REL:"rel",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",DIALOG_CLASS:"Css_Class",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",APPLY_CLASS:"Apply_Style",PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:new Array("p","h1","h2","h3","h4","h5","h6","pre","blockquote"),BLOCKS:new Array("address","blockquote","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","noscript","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr","meter","section","article","aside","details","header","footer","nav","dialog","figure","figcaption","address","hgroup","mark","time","canvas","audio","video","source","output","progress","ruby","rt","rp","summary","command"),KEY:{BACKSPACE:8,ENTER:13,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,CURSOR:new Array(37,38,39,40),DELETE:46},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(e,t){this._index=WYMeditor.INSTANCES.push(this)-1,this._element=e,this._options=t,this._html=$(e).val(),this._options.html&&(this._html=this._options.html),this._options.basePath=this._options.basePath||this.computeBasePath(),this._options.skinPath=this._options.skinPath||this._options.basePath+WYMeditor.SKINS_DEFAULT_PATH+this._options.skin+"/",this._options.cssCompiledSkinPath=this._options.cssCompiledSkinPath||(this._options.cssSkinPath||this._options.skinPath)+this._options.skin+"/",this._options.jsCompiledSkinPath=this._options.jsCompiledSkinPath||(this._options.jsSkinPath||this._options.skinPath)+this._options.skin+"/",this._options.wymPath=this._options.wymPath||this.computeWymPath(),this._options.langPath=this._options.langPath||this._options.basePath+WYMeditor.LANG_DEFAULT_PATH,this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT,this._options.jQueryPath=this._options.jQueryPath||this.computeJqueryPath(),this.init()}}),$.fn.wymeditor=function(e){return e=$.extend({html:"",basePath:!1,skinPath:!1,jsSkinPath:!1,cssSkinPath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,styles:!1,stylesheet:!1,skin:"default",initSkin:!0,loadSkin:!0,lang:"en",direction:"ltr",boxHtml:"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div>"+"<div class='wym_area_left'></div>"+"<div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div>"+"<div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div>"+"<div class='wym_area_bottom'>"+WYMeditor.LOGO+"</div>"+"</div>",logoHtml:"<a class='wym_wymeditor_link' href='http://www.wymeditor.org/'>WYMeditor</a>",iframeHtml:"<div class='wym_iframe wym_section'><iframe src='"+WYMeditor.IFRAME_BASE_PATH+"wymiframe.html' onload='"+"this.contentWindow.parent.WYMeditor.INSTANCES["+WYMeditor.INDEX+"].initIframe(this)'>"+"</iframe>"+"</div>",editorStyles:[],toolsHtml:"<div class='wym_tools wym_section'><h2>{Tools}</h2><ul>"+WYMeditor.TOOLS_ITEMS+"</ul>"+"</div>",toolsItemHtml:"<li class='"+WYMeditor.TOOL_CLASS+"'>"+"<a href='#' name='"+WYMeditor.TOOL_NAME+"' title='"+WYMeditor.TOOL_TITLE+"'>"+WYMeditor.TOOL_TITLE+"</a>"+"</li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",title:"Preview",css:"wym_tools_preview"}],containersHtml:"<div class='wym_containers wym_section'><h2>{Containers}</h2><ul>"+WYMeditor.CONTAINERS_ITEMS+"</ul>"+"</div>",containersItemHtml:"<li class='"+WYMeditor.CONTAINER_CLASS+"'>"+"<a href='#' name='"+WYMeditor.CONTAINER_NAME+"'>"+WYMeditor.CONTAINER_TITLE+"</a>"+"</li>",containersItems:[{name:"P",title:"Paragraph",css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",css:"wym_containers_th"}],classesHtml:"<div class='wym_classes wym_section'><h2>{Classes}</h2><ul>"+WYMeditor.CLASSES_ITEMS+"</ul></div>",classesItemHtml:"<li class='wym_classes_"+WYMeditor.CLASS_NAME+"'>"+"<a href='#' name='"+WYMeditor.CLASS_NAME+"'>"+WYMeditor.CLASS_TITLE+"</a>"+"</li>",classesItems:[],statusHtml:"<div class='wym_status wym_section'><h2>{Status}</h2></div>",htmlHtml:"<div class='wym_html wym_section'><h2>{Source_Code}</h2><textarea class='wym_html_val'></textarea></div>",boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",classUnhiddenSelector:".wym_classes",classHiddenSelector:".wym_classes_hidden",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",targetSelector:".wym_target",altSelector:".wym_alt",textSelector:".wym_text",sizeSelector:".wym_size",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",summarySelector:".wym_summary",submitSelector:".wym_submit",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:{width:560,height:300},dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",dialogHtml:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html dir='"+WYMeditor.DIRECTION+"'>"+"<head>"+"<link rel='stylesheet' type='text/css' media='screen'"+" href='"+WYMeditor.CSS_PATH+"' />"+"<title>"+WYMeditor.DIALOG_TITLE+"</title>"+"<script type='text/javascript' src='"+WYMeditor.JQUERY_PATH+"'></script>"+"<script type='text/javascript' src='"+WYMeditor.WYM_PATH+"'></script>"+"</head>"+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:"<div class='wym_dialog wym_dialog_link'><form><fieldset><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_LINK+"' />"+"<legend>{Link}</legend>"+"<div class='row'>"+"<label>{URL}</label>"+"<input type='text' class='wym_href' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Title}</label>"+"<input type='text' class='wym_title' value='' size='40' />"+"</div>"+"<div class='row row-indent'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</fieldset>"+"</form>"+"</div>",dialogImageHtml:"<div class='wym_dialog wym_dialog_image'><form><fieldset><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_IMAGE+"' />"+"<legend>{Image}</legend>"+"<div class='row'>"+"<label>{URL}</label>"+"<input type='text' class='wym_src' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Alternative_Text}</label>"+"<input type='text' class='wym_alt' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Title}</label>"+"<input type='text' class='wym_title' value='' size='40' />"+"</div>"+"<div class='row row-indent'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</fieldset>"+"</form>"+"</div>",dialogTableHtml:"<div class='wym_dialog wym_dialog_table'><form><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_TABLE+"' />"+"<div class='row'>"+"<label>{Caption}</label>"+"<input type='text' class='wym_caption' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Summary}</label>"+"<input type='text' class='wym_summary' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Number_Of_Rows}</label>"+"<input type='text' class='wym_rows' value='3' size='3' />"+"</div>"+"<div class='row'>"+"<label>{Number_Of_Cols}</label>"+"<input type='text' class='wym_cols' value='2' size='3' />"+"</div>"+"<div class='row row-indent'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</form>"+"</div>",dialogPasteHtml:"<div class='wym_dialog wym_dialog_paste'><form><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_PASTE+"' />"+"<fieldset>"+"<legend>{Paste_From_Word}</legend>"+"<div class='row'>"+"<textarea class='wym_text' rows='10' cols='50'></textarea>"+"</div>"+"<div class='row'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</fieldset>"+"</form>"+"</div>",dialogPreviewHtml:"<div class='wym_dialog wym_dialog_preview'></div>",dialogStyles:[],stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},e),this.each(function(){new WYMeditor.editor($(this),e)})},$.extend({wymeditors:function(e){return WYMeditor.INSTANCES[e]}}),WYMeditor.loadCss=function(e){$("<link rel='stylesheet' />").attr("href",e).appendTo($("head").get(0))},WYMeditor.INIT_DIALOG=function(e,t,n){var t=t||e.selected(),r=$("#"+e._options.dialogId),i=$(r.find("iframe").contents()),s=r.find("#wym_dialog_type").val();if(e._selected_image)var o=$(e._selected_image);else var o=$(e._doc.body).find("#"+e._current_unique_stamp);r.find("input[type=text], textarea").first().focus(),i.find("body").addClass("wym_iframe_body").find("#cancel_button").add(r.find(".close_dialog")).click(function(t){e.close_dialog(t,!0)}),$(".ui-dialog-titlebar .ui-dialog-titlebar-close").click(function(t){e.close_dialog(t,!0)}),$.isFunction(e._options.preInitDialog)&&e._options.preInitDialog(e,window),$(e._options.dialogLinkSelector).find(e._options.submitSelector).click(function(t){if((sUrl=$(e._options.hrefSelector).val()).length>0)if(o.get(0)!=null){var n=$("<a></a>").attr({href:sUrl,title:$(e._options.titleSelector).val()});(target=$(e._options.targetSelector).val())!=null&&target.length>0&&n.attr("target",target),e._selected_image?(parent=o.parent().get(0))!=null&&parent.tagName.toUpperCase()=="A"?$(parent).attr({href:n.attr("href"),title:$(e._options.titleSelector).val(),target:target}):(o.before(n),$(n).append(o.get(0))):(n.attr({style:o.attr("style"),"class":o.attr("class")}),n.html(o.html()),o.replaceWith($("<div/>").append(n).html()))}else e._exec(WYMeditor.CREATE_LINK,e._current_unique_stamp),$("a[href="+e._current_unique_stamp+"]",e._doc.body).attr(WYMeditor.HREF,sUrl).attr(WYMeditor.TITLE,$(e._options.titleSelector).val()).attr(WYMeditor.TARGET,$(e._options.targetSelector).val());e.close_dialog(t)}),e._selected_image&&(imgDialog=$(e._options.dialogImageSelector),img=$(e._selected_image),size=img.attr(WYMeditor.REL)||i.find("#existing_image_size_area li.selected a").attr("rel")||"",src=img.attr(WYMeditor.SRC),size.length>0&&(src=src.replace("_"+size+".","."),i.find("#existing_image_size_area li.selected").removeClass("selected"),i.find("#existing_image_size_area li a[href='#"+size+"']").parents("li:first").addClass("selected")),imgDialog.find(e._options.srcSelector).val(src),imgDialog.find(e._options.titleSelector).val(img.attr(WYMeditor.TITLE)),imgDialog.find(e._options.altSelector).val(img.attr(WYMeditor.ALT)),imgDialog.find(e._options.sizeSelector).val(size),(src=src.split(".")).pop(),i.find("#existing_image_area_content li img[src^='"+src+"']").parents("li:first").addClass("selected")),$(e._options.dialogImageSelector).find(e._options.submitSelector).click(function(t){form=$(this.form),(url=form.find(e._options.srcSelector).val())!=null&&url.length>0?((image=$(e._doc.createElement("IMG"))).attr(WYMeditor.SRC,url).attr(WYMeditor.TITLE,form.find(e._options.titleSelector).val()).attr(WYMeditor.ALT,form.find(e._options.altSelector).val()).attr(WYMeditor.REL,form.find(e._options.sizeSelector).val()).load(function(e){$(this).attr({width:$(this).width(),height:$(this).height()})}),o==null&&(o=$(e._doc.body).find("#"+e._current_unique_stamp)),o!=null&&o.after(image).remove(),e.close_dialog(t)):($("iframe").contents().find(".save-loader").remove(),alert("Please select an image to insert.")),t.preventDefault()}),$(e._options.dialogTableSelector).find(e._options.submitSelector).click(function(t){if((iRows=$(e._options.rowsSelector).val())>0&&(iCols=$(e._options.colsSelector).val())>0){(table=e._doc.createElement(WYMeditor.TABLE)).createCaption().innerHTML=$(e._options.captionSelector).val();for(x=0;x<iRows;x++){newRow=table.insertRow(x);for(y=0;y<iCols;y++)newRow.insertCell(y)}var n=$(e.findUp(e.container(),WYMeditor.MAIN_CONTAINERS)).get(0);!n||!n.parentNode?$(e._doc.body).append(table):$(n).after(table)}e.close_dialog(t)}),$(e._options.dialogPasteSelector).find(e._options.submitSelector).click(function(t){e.paste($(e._options.textSelector).val()),e.close_dialog(t)}),$(e._options.dialogPreviewSelector).find(e._options.previewSelector).html(e.xhtml()),$.isFunction(e._options.postInitDialog)&&e._options.postInitDialog(e,window)},WYMeditor.editor.prototype.close_dialog=function(e,t){if(t){(span=$(this._doc.body).find("span#"+this._current_unique_stamp)).length>0&&span.parent().html(span.parent().html().replace(new RegExp(["<span(.+?)",span.attr("id"),"(.+?)</span>"].join("")),span.html()));if(node=$(this._doc.body).find("#"+this._current_unique_stamp))node.attr("id",node.attr("_id_before_replaceable")||""),node.removeAttr("_id_before_replaceable");this._undo_on_cancel==1?this._exec("undo"):this._redo_on_cancel==1&&this._exec("redo")}$.browser.msie&&parseInt($.browser.version)<8&&this._iframe.contentWindow.focus(),$("#"+wym._options.dialogId).dialog("close").remove(),$(this._doc).find("a[href]").click(function(e){e.preventDefault()}),e&&e.preventDefault()},RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},WYMeditor.editor.prototype.init=function(){if($.browser.msie)var WymClass=new WYMeditor.WymClassExplorer(this);else if($.browser.mozilla)var WymClass=new WYMeditor.WymClassMozilla(this);else if($.browser.opera)var WymClass=new WYMeditor.WymClassOpera(this);else if($.browser.webkit)var WymClass=new WYMeditor.WymClassSafari(this);if(WymClass){$.isFunction(this._options.preInit)&&this._options.preInit(this);var SaxListener=new WYMeditor.XhtmlSaxListener;$.extend(SaxListener,WymClass),this.parser=new WYMeditor.XhtmlParser(SaxListener),(this._options.styles||this._options.stylesheet)&&this.configureEditorUsingRawCss(),this.helper=new WYMeditor.XmlHelper;for(var prop in WymClass)this[prop]=WymClass[prop];this._box=$(this._element).hide().after(this._options.boxHtml).next().addClass("wym_box_"+this._index),$.isFunction($.fn.data)&&($.data(this._box.get(0),WYMeditor.WYM_INDEX,this._index),$.data(this._element.get(0),WYMeditor.WYM_INDEX,this._index));var h=WYMeditor.Helper,iframeHtml=this._options.iframeHtml;iframeHtml=h.replaceAll(iframeHtml,WYMeditor.INDEX,this._index),iframeHtml=h.replaceAll(iframeHtml,WYMeditor.IFRAME_BASE_PATH,this._options.iframeBasePath);var boxHtml=$(this._box).html();boxHtml=h.replaceAll(boxHtml,WYMeditor.LOGO,this._options.logoHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS,this._options.toolsHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS,this._options.containersHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES,this._options.classesHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.HTML,this._options.htmlHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.IFRAME,iframeHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.STATUS,this._options.statusHtml);var aTools=eval(this._options.toolsItems),sTools="";for(var i=0;i<aTools.length;i++){var oTool=aTools[i];if(oTool.name&&oTool.title){var sTool=this._options.toolsItemHtml,sTool=h.replaceAll(sTool,WYMeditor.TOOL_NAME,oTool.name);sTool=h.replaceAll(sTool,WYMeditor.TOOL_TITLE,this._options.stringDelimiterLeft+oTool.title+this._options.stringDelimiterRight),sTool=h.replaceAll(sTool,WYMeditor.TOOL_CLASS,oTool.css),sTools+=sTool}}boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS_ITEMS,sTools);var aClasses=eval(this._options.classesItems),sClasses="";for(var i=0;i<aClasses.length;i++){var oClass=aClasses[i];if(oClass.name)if(oClass.rules&&oClass.rules.length>0){var sRules="",wym=this;$.each(oClass.rules,function(e,t){sClass=wym._options.classesItemHtml,sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name+(oClass.join||"")+(t.name||t)),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,t.title||titleize(t.name||t)),sRules+=sClass});var sClassMultiple=this._options.classesItemHtmlMultiple;sClassMultiple=h.replaceAll(sClassMultiple,WYMeditor.CLASS_TITLE,oClass.title||titleize(oClass.name)),sClassMultiple=h.replaceAll(sClassMultiple,"{classesItemHtml}",sRules),sClasses+=sClassMultiple}else sClass=this._options.classesItemHtml,sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,oClass.title||titleize(oClass.name)),sClasses+=sClass}boxHtml=h.replaceAll(boxHtml,">"+WYMeditor.APPLY_CLASS+"<",">"+this._options.stringDelimiterLeft+WYMeditor.APPLY_CLASS+this._options.stringDelimiterRight+"<"),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES_ITEMS,sClasses);var aContainers=eval(this._options.containersItems),sContainers="";for(var i=0;i<aContainers.length;i++){var oContainer=aContainers[i];if(oContainer.name&&oContainer.title){var sContainer=this._options.containersItemHtml;sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_NAME,oContainer.name),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_TITLE,this._options.stringDelimiterLeft+oContainer.title+this._options.stringDelimiterRight),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_CLASS,oContainer.css),sContainers+=sContainer}}boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS_ITEMS,sContainers),boxHtml=this.replaceStrings(boxHtml),$(this._box).html(boxHtml),$(this._box).find(this._options.htmlSelector).hide(),this.loadSkin(),$(this._element).data("wymeditor",this)}},WYMeditor.editor.prototype.bindEvents=function(){var wym=this;$(this._box).find(this._options.toolSelector).click(function(){return wym._iframe.contentWindow.focus(),wym.exec($(this).attr(WYMeditor.NAME)),!1}),$(this._box).find(this._options.containerSelector).click(function(){return wym.container($(this).attr(WYMeditor.NAME)),!1}),$(this._box).find(this._options.htmlValSelector).keyup(function(){$(wym._doc.body).html($(this).val())}).focus(function(){$(this).toggleClass("hasfocus")}).blur(function(){$(this).toggleClass("hasfocus")}),$(this._box).find(this._options.classSelector).bind("click",function(e){var aClasses=eval(wym._options.classesItems),sName=$(this).attr(WYMeditor.NAME),oClass=WYMeditor.Helper.findByName(aClasses,sName),replacers=$([]);oClass==null&&$.each(aClasses,function(e,t){if(oClass==null&&t.rules&&t.rules.length>0){var n=sName.replace(t.name+(t.join||""),""),r=null;$.each(t.rules,function(e,i){n==(i.name||i)?r=e:replacers.push(t.name+(t.join||"")+(i.name||i))}),r!=null&&(oClass={expr:t.rules[r].expr||null})}}),oClass&&(replacers.each(function(e,t){wym.removeClass(t,oClass.expr)}),wym.toggleClass(sName,oClass.expr)),wym.exec(WYMeditor.APPLY_CLASS),wym._iframe.contentWindow.focus(),e.preventDefault()}),$(this._options.updateSelector).bind(this._options.updateEvent,function(){wym.update()})},WYMeditor.editor.prototype.ready=function(){return this._doc!=null},WYMeditor.editor.prototype.box=function(){return this._box},WYMeditor.editor.prototype.html=function(e){if(typeof e!="string")return $(this._doc.body).html();$(this._doc.body).html(e)},WYMeditor.editor.prototype.intercept_paste=function(e){var t=WYMeditor.INSTANCES[this.title];t.format_block(),t.exec(WYMeditor.PASTE),e&&e.preventDefault()},WYMeditor.editor.prototype.xhtml=function(){return this.parser.parse(this.html())},WYMeditor.editor.prototype.exec=function(e){switch(e){case WYMeditor.CREATE_LINK:((container=this.container())||this._selected_image)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:this.update(),this.toggleHtml();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW);break;case WYMeditor.APPLY_CLASS:wym=this,$(wym._box).find(this._options.classUnhiddenSelector).find("a[name]").each(function(e,t){$(wym.selected()).hasClass($(t).attr("name"))?$(t).parent().addClass("enabled"):$(t).parent().removeClass("enabled")});break;default:this._exec(e)}},WYMeditor.editor.prototype.container=function(e){if(!e)return this.selected();var t=null;if(e.toLowerCase()==WYMeditor.TH){t=this.container();switch(t.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:var n=new Array(WYMeditor.TD,WYMeditor.TH);t=this.findUp(this.container(),n)}t!=null&&(e=t.tagName.toLowerCase()==WYMeditor.TD?WYMeditor.TH:WYMeditor.TD,this.switchTo(t,e),this.update())}else{var n=new Array(WYMeditor.P,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE);t=this.findUp(this.container(),n);if(t){var r=null;if(e.toLowerCase()==WYMeditor.BLOCKQUOTE){var i=this.findUp(this.container(),WYMeditor.BLOCKQUOTE);if(i==null)r=this._doc.createElement(e),t.parentNode.insertBefore(r,t),r.appendChild(t),this.setFocusToNode(r.firstChild);else{var s=i.childNodes,o=s.length,u=null;o>0&&(u=s.item(0));for(var a=0;a<o;a++)i.parentNode.insertBefore(s.item(0),i);i.parentNode.removeChild(i),u&&this.setFocusToNode(u)}}else this.setFocusToNode(this.switchTo(t,e));this.update()}}},WYMeditor.editor.prototype.toggleClass=function(e,t){var n=$(this._selected_image?this._selected_image:this.selected(!0));t!=null&&(n=$(n.parentsOrSelf(t))),n.toggleClass(e),n.attr(WYMeditor.CLASS)||n.removeAttr(this._class)},WYMeditor.editor.prototype.toggleClassSelector=function(){var e=this,t=$(e._box).find(e._options.classUnhiddenSelector).hasClass(e._options.classHiddenSelector.substring(1));t?($(e._box).find(e._options.classUnhiddenSelector).removeClass(e._options.classHiddenSelector.substring(1)),$(e._box).find("a[name="+WYMeditor.APPLY_CLASS+"]").addClass("selected").parent().addClass("activated")):($(e._box).find(e._options.classUnhiddenSelector).addClass(e._options.classHiddenSelector.substring(1)),$(e._box).find("a[name="+WYMeditor.APPLY_CLASS+"]").removeClass("selected").parent().removeClass("activated")),e.exec(WYMeditor.APPLY_CLASS)},WYMeditor.editor.prototype.removeClass=function(e,t){var n=$(this._selected_image?this._selected_image:$(this.selected(!0)));t!=null&&(n=$(n.parentsOrSelf(t))),n.removeClass(e),n.attr(WYMeditor.CLASS)||n.removeAttr(this._class)},WYMeditor.editor.prototype.findUp=function(e,t){if(e){var n=e.tagName.toLowerCase();if(typeof t==WYMeditor.STRING)while(n!=t&&n!=WYMeditor.BODY)e=e.parentNode,n=e.tagName.toLowerCase();else{var r=!1;while(!r&&n!=WYMeditor.BODY){for(var i=0;i<t.length;i++)if(n==t[i]){r=!0;break}r||(e=e.parentNode,n=e.tagName.toLowerCase())}}return n!=WYMeditor.BODY?e:null}return null},WYMeditor.editor.prototype.switchTo=function(e,t){e.getRangeAt&&(this.exec(WYMeditor.BOLD),e=e.focusNode.parentNode);var n=$(e).html(),r=this._doc.createElement(t),i=$(e).attr("class");return typeof i!="undefined"&&$.each($(e).attr("class").split(" "),function(e,t){$(r).addClass(t)}),e.parentNode.replaceChild(r,e),$(r).html(n),this.setFocusToNode(r),r},WYMeditor.editor.prototype.replaceStrings=function(sVal){var wym=this;if(!WYMeditor.STRINGS[wym._options.lang])try{eval($.ajax({url:wym._options.langPath+wym._options.lang+".js",async:!1}).responseText)}catch(e){return WYMeditor.console&&WYMeditor.console.error("WYMeditor: error while parsing language file."),sVal}return $.each(WYMeditor.STRINGS[wym._options.lang],function(e,t){sVal=WYMeditor.Helper.replaceAll(sVal,wym.encloseString(e),t)}),sVal},WYMeditor.editor.prototype.encloseString=function(e){return this._options.stringDelimiterLeft+e+this._options.stringDelimiterRight},WYMeditor.editor.prototype.status=function(e){$(this._box).find(this._options.statusSelector).html(e)},WYMeditor.editor.prototype.update=function(){var e=this,t=e.xhtml().replace(/<\/([A-Za-z0-9]*)></g,function(e){return e.split(">").join(">\n")});t=t.replace(/src=\"system\/images/g,'src="/system/images'),$(t).find(bad_spans="span[id|=wym], span[id=undefined]").add($(t).filter(bad_spans)).each(function(n,r){html_to_replace_with=e.parser.parse($(r).html()),html_to_replace=e.parser.parse($(r).wrap("<div />").parent().html()),$.browser.msie&&(html_to_replace=new RegExp(html_to_replace.replace(/(\ [^\=]+\=)([^\ >]+)/,'$1"$2"'),"ig")),t=t.replace(html_to_replace,html_to_replace_with)}),t=t.replace(/(\ ?id=(\"|\')last\_paste(\"|\'))/igm,""),t=t.replace(/[%$]+wym-[^%$]*[%$]+/igm,""),t=t.replace(/^<br\ ?\/?>$/,""),$(e._element).val(t),$(e._box).find(e._options.htmlValSelector).not(".hasfocus").val(t)},WYMeditor.editor.prototype.dialog=function(e){var t=this;t.update();var n=this._wym._options.dialogPath+e+"?wymeditor=true&"+window.location.href.match(/switch_locale=[a-z]{2}/);t._current_unique_stamp=t.uniqueStamp(),t._undo_on_cancel=!1,t._redo_on_cancel=!1;var r=this.selected();e!=WYMeditor.DIALOG_TABLE&&t.format_block(),e==WYMeditor.DIALOG_LINK&&$.browser.mozilla&&(selection=t._iframe.contentWindow.getSelection(),matches=$($(r).html().match(new RegExp(RegExp.escape(selection.anchorNode.textContent)+"(.*)"+RegExp.escape(selection.focusNode.textContent)))),matches!=null&&matches.length>0&&(possible_anchor_tag=matches.last()).length>0&&(href_matches=possible_anchor_tag.get(0).match(/href="([^"]*)"/))!=null&&(href=$(href_matches).last().get(0))!=null&&$(t._doc).find("a").each(function(e,t){$(t).html()==selection&&(r=t)})),ajax_loaded_callback=function(){t.dialog_ajax_callback(r)};var i=t._selected_image?t._selected_image.parentNode:r;if(typeof i!="undefined"&&i!==null)if(i.tagName.toLowerCase()!=WYMeditor.A){if(t._selected_image==null)if(r!=null&&r.tagName.toLowerCase()!=WYMeditor.A&&t._iframe.contentWindow.getSelection){selection=t._iframe.contentWindow.getSelection();if(selection.focusNode.insertData){selection.anchorOffset>selection.focusOffset?(start_node=selection.focusNode,start=selection.focusOffset,end_node=selection.anchorNode,end=selection.anchorOffset):(start_node=selection.anchorNode,start=selection.anchorOffset,end_node=selection.focusNode,end=selection.focusOffset);if(typeof start_node.insertData=="undefined"){var s=start_node.childNodes.length-1,o=start_node;while(typeof end_node.insertData!="function"||!s)start_node=o.childNodes[s--];start=0}if(typeof end_node.insertData=="undefined"){var u=end_node.childNodes.length-1,a=end_node;while(typeof end_node.insertData!="function"||!u)end_node=a.childNodes[u--];end=end_node.length}start_tag="%%"+t._current_unique_stamp+"%%",end_tag="$$"+t._current_unique_stamp+"$$",start_node===end_node&&(end+=start_tag.length),start_node.insertData(start,start_tag),end_node.insertData(end,end_tag),$(r).html($(r).html().replace(start_tag,"<span id='"+t._current_unique_stamp+"'>").replace(end_tag,"</span>"))}else t.wrap("<span id='"+t._current_unique_stamp+"'>","</span>")}else t.wrap("<span id='"+t._current_unique_stamp+"'>","</span>")}else t._selected_image||(i._id_before_replaceable=i.id,i.id=""+this._current_unique_stamp,$(i).attr("_id_before_replaceable",i._id_before_replaceable)),e!=WYMeditor.DIALOG_PASTE&&e!=WYMeditor.DIALOG_TABLE&&(n+=n.indexOf("?")==-1?"?":"&",port=window.location.port.length>0?":"+window.location.port:"",n+="current_link="+i.href.replace(window.location.protocol+"//"+window.location.hostname+port,""),n+="&target_blank="+(i.target=="_blank"?"true":"false"));dialog_title=t.replaceStrings(t.encloseString(e)),dialog_container=$("<div id='"+t._options.dialogId+"' class='editor_dialog'></div>");switch(e){case WYMeditor.DIALOG_TABLE:dialog_container.html(t.replaceStrings(t._options.dialogTableHtml)).dialog($.extend(t._options.dialogInlineFeatures,{title:dialog_title})),ajax_loaded_callback();break;case WYMeditor.DIALOG_PASTE:dialog_container.html(t.replaceStrings(t._options.dialogPasteHtml)).dialog($.extend(t._options.dialogInlineFeatures,{title:dialog_title})),ajax_loaded_callback();break;default:$("<img id='dialog_loading' src='/assets/refinery/dialogLoadingAnimation-1e1cbd25e2adc4ddd8ed12d46ab2f58b.gif' width='208' height='13' />").appendTo(dialog_container),dialog_container.dialog($.extend(t._options.dialogFeatures,{title:dialog_title})).load(n,ajax_loaded_callback)}},WYMeditor.editor.prototype.dialog_ajax_callback=function(e){wym=this,_selected=e,$("#"+wym._options.dialogId+".editor_dialog").css("height","auto"),$("#"+wym._options.dialogId+" .button").corner("6px"),(iframes=$("#"+this._options.dialogId).find("iframe")).load(function(){WYMeditor.INIT_DIALOG(wym,_selected,!0),$(this).unbind("load")}),iframes.length==0&&WYMeditor.INIT_DIALOG(this,e)},WYMeditor.editor.prototype.toggleHtml=function(){$(this._box).find(this._options.htmlSelector).toggle()},WYMeditor.editor.prototype.uniqueStamp=function(){return"wym-"+(new Date).getTime()},WYMeditor.editor.prototype.paste=function(e){wym=this,wym.format_block();var t;replaceable=$(wym._doc.body).find("#"+wym._current_unique_stamp),container=replaceable.get(0)||this.selected
();var n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").split(wym._newLine+wym._newLine),r=new RegExp(wym._newLine,"g");if(container&&container.tagName.toLowerCase()!=WYMeditor.BODY){contentAfterBreak="",insertedContentAfterBreak="";for(x=n.length-1;x>=0;x--){t=n[x].replace(r,"<br />");if(x==0)n.length>1&&$(container).get(0).tagName.toLowerCase()=="span"&&$(container).attr("id")==""+wym._current_unique_stamp&&$(container).parent().get(0).tagName.toLowerCase()=="p"?(p=$(container).parent(),matches=p.html().match(new RegExp("([\\s\\S]*)<span id=['|\"]"+wym._current_unique_stamp+"['|\"]>.*</span>")),t=matches[1]+t+$(container).html(),p.html(t),insertedContentAfterBreak!=null&&insertedContentAfterBreak.length>0&&p.after(insertedContentAfterBreak),contentAfterBreak!=null&&contentAfterBreak.length>0&&((last_paste=p.parent().find("p#last_paste")).length==1?last_paste.attr("id",null).html(last_paste.html()+contentAfterBreak):p.next().after("<p>"+contentAfterBreak+"</p>"))):$(container).html($(container).html().replace(/^<br\/?>$/,"")+t);else{if(n.length-1==x){var i=$(container).parent().html().match(new RegExp("<span id=['|\"]"+wym._current_unique_stamp+"['|\"]>.*</span>([\\s\\S]*)"));i&&i[1]&&(contentAfterBreak=i[1].split("</p>")[0]),t="<p id='last_paste'>"+t+"</p>"}else t="<p>"+t+"</p>";insertedContentAfterBreak==""?insertedContentAfterBreak+=t:insertedContentAfterBreak=t+insertedContentAfterBreak}}}else for(x=0;x<n.length;x++)t=n[x],t=t.replace(r,"<br />"),x==0&&$(container).html().replace(/<br\ ?\/?>/,"").length==0?$(container).html(t):$(wym._doc.body).append("<p>"+t+"</p>");replaceable.get(0)!=null&&(replaceable.get(0).tagName.toLowerCase()=="span"&&replaceable.replaceWith(replaceable.html()),replaceable.attr("id",replaceable.get(0)._id_before_replaceable||null))},WYMeditor.editor.prototype.insert=function(e){this._iframe.contentWindow.getSelection().focusNode!=null?this._exec(WYMeditor.INSERT_HTML,e):this.paste(e)},WYMeditor.editor.prototype.wrap=function(e,t,n){e=typeof e!="undefined"?e:"",t=typeof t!="undefined"?t:"",n==null&&(n=this._iframe.contentWindow.getSelection()),n.focusNode!=null&&this._exec(WYMeditor.INSERT_HTML,e+n.toString()+t)},WYMeditor.editor.prototype.unwrap=function(e){e==null&&(e=this._iframe.contentWindow.getSelection()),e.focusNode!=null&&this._exec(WYMeditor.INSERT_HTML,e.toString())},WYMeditor.editor.prototype.setFocusToNode=function(e,t){var n=this._doc.createRange(),r=this._iframe.contentWindow.getSelection();t=t?0:1,n.selectNodeContents(e),r.addRange(n),r.collapse(e,t),this._iframe.contentWindow.focus()},WYMeditor.editor.prototype.addCssRules=function(e,t){var n=e.styleSheets[0];if(n)for(var r=0;r<t.length;r++){var i=t[r];i.name&&i.css&&this.addCssRule(n,i)}},WYMeditor.editor.prototype.format_block=function(e){var t=this,n=e||t.selected()||$(t._iframe).contents().find("body").get(0),r=n.tagName.toLowerCase();$.inArray(r,["strong","b","em","i","sub","sup","a"])>-1&&(r=n.parentNode.tagName.toLowerCase()),r==WYMeditor.BODY&&(t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))},WYMeditor.editor.prototype.computeBasePath=function(){return(script_path=this.computeWymPath())!=null?((src_parts=script_path.split("/")).length>1&&src_parts.pop(),src_parts.join("/")+"/"):null},WYMeditor.editor.prototype.computeWymPath=function(){return $("script[src*=jquery.refinery.wymeditor]").attr("src")},WYMeditor.editor.prototype.computeJqueryPath=function(){return $($.grep($("script"),function(e){return e.src&&e.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.editor.prototype.computeCssPath=function(){return $($.grep($("link"),function(e){return e.href&&e.href.match(/wymeditor\/skins\/(.*)screen\.css(\?.*)?$/)})).attr("href")},WYMeditor.editor.prototype.configureEditorUsingRawCss=function(){var e=new WYMeditor.WymCssParser;this._options.stylesheet?e.parse($.ajax({url:this._options.stylesheet,async:!1}).responseText):e.parse(this._options.styles,!1),this._options.classesItems.length==0&&(this._options.classesItems=e.css_settings.classesItems),this._options.editorStyles.length==0&&(this._options.editorStyles=e.css_settings.editorStyles),this._options.dialogStyles.length==0&&(this._options.dialogStyles=e.css_settings.dialogStyles)},WYMeditor.editor.prototype.listen=function(){$(this._doc.body).bind("mousedown",this.mousedown);var e=this._doc.body.getElementsByTagName("img");for(var t=0;t<e.length;t++)$(e[t]).bind("mousedown",this.mousedown);$(this._doc).find("a[href]").click(function(e){e.preventDefault()})},WYMeditor.editor.prototype.mousedown=function(e){var t=WYMeditor.INSTANCES[this.ownerDocument.title];t._selected_image=e.target.tagName.toLowerCase()==WYMeditor.IMG?e.target:null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),$.browser.mozilla||$(t._selected_image).addClass("selected_by_wym"),$.browser.webkit||e.stopPropagation()},WYMeditor.editor.prototype.loadSkin=function(){if(this._options.loadSkin&&!WYMeditor.SKINS[this._options.skin]){var found=!1,rExp=new RegExp(this._options.skin+"/"+WYMeditor.SKINS_DEFAULT_CSS+"([?].+?)?$");$("link").each(function(){this.href.match(rExp)&&(found=!0)}),found||WYMeditor.loadCss(this._options.cssCompiledSkinPath+WYMeditor.SKINS_DEFAULT_CSS)}$(this._box).addClass("wym_skin_"+this._options.skin),this._options.initSkin&&!WYMeditor.SKINS[this._options.skin]&&eval($.ajax({url:this._options.jsCompiledSkinPath+WYMeditor.SKINS_DEFAULT_JS,async:!1}).responseText),WYMeditor.SKINS[this._options.skin]&&WYMeditor.SKINS[this._options.skin].init&&WYMeditor.SKINS[this._options.skin].init(this)},WYMeditor.XmlHelper=function(){return this._entitiesDiv=document.createElement("div"),this},WYMeditor.XmlHelper.prototype.tag=function(e,t,n){return t=t||!1,n=n||!1,"<"+e+(t?this.tagOptions(t):"")+(n?">":" />")},WYMeditor.XmlHelper.prototype.contentTag=function(e,t,n){return n=n||!1,"<"+e+(n?this.tagOptions(n):"")+">"+t+"</"+e+">"},WYMeditor.XmlHelper.prototype.cdataSection=function(e){return"<![CDATA["+e+"]]>"},WYMeditor.XmlHelper.prototype.escapeOnce=function(e){return this._fixDoubleEscape(this.escapeEntities(e))},WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(e){return e.replace(/&amp;([a-z]+|(#\d+));/ig,"&$1;")},WYMeditor.XmlHelper.prototype.tagOptions=function(e){var t=this;t._formated_options="";for(var n in e){var r="",i=e[n];typeof i!="function"&&i.length>0&&(parseInt(n)==n&&typeof i=="object"&&(n=i.shift(),i=i.pop()),n!=""&&i!=""&&(t._formated_options+=" "+n+'="'+t.escapeOnce(i)+'"'))}return t._formated_options},WYMeditor.XmlHelper.prototype.escapeEntities=function(e,t){this._entitiesDiv.innerHTML=e,this._entitiesDiv.textContent=e;var n=this._entitiesDiv.innerHTML;return typeof t=="undefined"&&(t!=0&&(n=n.replace('"',"&quot;")),t==1&&(n=n.replace('"',"&#039;"))),n},WYMeditor.XmlHelper.prototype.parseAttributes=function(e){var t=[],n=e.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(n.toString()!=e)for(var r in n){var i=n[r];if(typeof i!="function"&&i.length!=0){var s=new RegExp("(\\w+)\\s*"+i);if(match=e.match(s)){var o=i.replace(/^[\s=]+/,""),u=o.charAt(0);u=u=='"'?'"':u=="'"?"'":"",u!=""&&(o=u=='"'?o.replace(/^"|"+$/g,""):o.replace(/^'|'+$/g,"")),e=e.replace(match[0],""),t.push([match[1],o])}}}return t},WYMeditor.ParallelRegex=function(e){return this._case=e,this._patterns=[],this._labels=[],this._regex=null,this},WYMeditor.ParallelRegex.prototype.addPattern=function(e,t){t=t||!0;var n=this._patterns.length;this._patterns[n]=e,this._labels[n]=t,this._regex=null},WYMeditor.ParallelRegex.prototype.match=function(e){if(this._patterns.length==0)return[!1,""];var t=e.match(this._getCompoundedRegex());if(!t)return[!1,""];var n=t[0];for(var r=1;r<t.length;r++)if(t[r])return[this._labels[r-1],n];return[!0,t[0]]},WYMeditor.ParallelRegex.prototype._getCompoundedRegex=function(){if(this._regex==null){for(var e=0,t=this._patterns.length;e<t;e++)this._patterns[e]="("+this._untokenizeRegex(this._tokenizeRegex(this._patterns[e]).replace(/([\/\(\)])/g,"\\$1"))+")";this._regex=new RegExp(this._patterns.join("|"),this._getPerlMatchingFlags())}return this._regex},WYMeditor.ParallelRegex.prototype._tokenizeRegex=function(e){return e.replace(/\(\?(i|m|s|x|U)\)/,"~~~~~~Tk1$1~~~~~~").replace(/\(\?(\-[i|m|s|x|U])\)/,"~~~~~~Tk2$1~~~~~~").replace(/\(\?\=(.*)\)/,"~~~~~~Tk3$1~~~~~~").replace(/\(\?\!(.*)\)/,"~~~~~~Tk4$1~~~~~~").replace(/\(\?\<\=(.*)\)/,"~~~~~~Tk5$1~~~~~~").replace(/\(\?\<\!(.*)\)/,"~~~~~~Tk6$1~~~~~~").replace(/\(\?\:(.*)\)/,"~~~~~~Tk7$1~~~~~~")},WYMeditor.ParallelRegex.prototype._untokenizeRegex=function(e){return e.replace(/~~~~~~Tk1(.{1})~~~~~~/,"(?$1)").replace(/~~~~~~Tk2(.{2})~~~~~~/,"(?$1)").replace(/~~~~~~Tk3(.*)~~~~~~/,"(?=$1)").replace(/~~~~~~Tk4(.*)~~~~~~/,"(?!$1)").replace(/~~~~~~Tk5(.*)~~~~~~/,"(?<=$1)").replace(/~~~~~~Tk6(.*)~~~~~~/,"(?<!$1)").replace(/~~~~~~Tk7(.*)~~~~~~/,"(?:$1)")},WYMeditor.ParallelRegex.prototype._getPerlMatchingFlags=function(){return this._case?"m":"mi"},WYMeditor.StateStack=function(e){return this._stack=[e],this},WYMeditor.StateStack.prototype.getCurrent=function(){return this._stack[this._stack.length-1]},WYMeditor.StateStack.prototype.enter=function(e){this._stack.push(e)},WYMeditor.StateStack.prototype.leave=function(){return this._stack.length==1?!1:(this._stack.pop(),!0)},WYMeditor.LEXER_ENTER=1,WYMeditor.LEXER_MATCHED=2,WYMeditor.LEXER_UNMATCHED=3,WYMeditor.LEXER_EXIT=4,WYMeditor.LEXER_SPECIAL=5,WYMeditor.Lexer=function(e,t,n){return t=t||"accept",this._case=n||!1,this._regexes={},this._parser=e,this._mode=new WYMeditor.StateStack(t),this._mode_handlers={},this._mode_handlers[t]=t,this},WYMeditor.Lexer.prototype.addPattern=function(e,t){var t=t||"accept";typeof this._regexes[t]=="undefined"&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e),typeof this._mode_handlers[t]=="undefined"&&(this._mode_handlers[t]=t)},WYMeditor.Lexer.prototype.addEntryPattern=function(e,t,n){typeof this._regexes[t]=="undefined"&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,n),typeof this._mode_handlers[n]=="undefined"&&(this._mode_handlers[n]=n)},WYMeditor.Lexer.prototype.addExitPattern=function(e,t){typeof this._regexes[t]=="undefined"&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,"__exit"),typeof this._mode_handlers[t]=="undefined"&&(this._mode_handlers[t]=t)},WYMeditor.Lexer.prototype.addSpecialPattern=function(e,t,n){typeof this._regexes[t]=="undefined"&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,"_"+n),typeof this._mode_handlers[n]=="undefined"&&(this._mode_handlers[n]=n)},WYMeditor.Lexer.prototype.mapHandler=function(e,t){this._mode_handlers[e]=t},WYMeditor.Lexer.prototype.parse=function(e){if(typeof this._parser=="undefined")return!1;var t=e.length,n;while(typeof (n=this._reduce(e))=="object"){var e=n[0],r=n[1],i=n[2],s=n[3];if(!this._dispatchTokens(r,i,s))return!1;if(e=="")return!0;if(e.length==t)return!1;t=e.length}return n?this._invokeParser(e,WYMeditor.LEXER_UNMATCHED):!1},WYMeditor.Lexer.prototype._dispatchTokens=function(e,t,n){return n=n||!1,this._invokeParser(e,WYMeditor.LEXER_UNMATCHED)?typeof n=="boolean"?this._invokeParser(t,WYMeditor.LEXER_MATCHED):this._isModeEnd(n)?this._invokeParser(t,WYMeditor.LEXER_EXIT)?this._mode.leave():!1:this._isSpecialMode(n)?(this._mode.enter(this._decodeSpecial(n)),this._invokeParser(t,WYMeditor.LEXER_SPECIAL)?this._mode.leave():!1):(this._mode.enter(n),this._invokeParser(t,WYMeditor.LEXER_ENTER)):!1},WYMeditor.Lexer.prototype._isModeEnd=function(e){return e==="__exit"},WYMeditor.Lexer.prototype._isSpecialMode=function(e){return e.substring(0,1)=="_"},WYMeditor.Lexer.prototype._decodeSpecial=function(e){return e.substring(1)},WYMeditor.Lexer.prototype._invokeParser=function(content,is_match){if(content==="")return!0;var current=this._mode.getCurrent(),handler=this._mode_handlers[current],result;return eval("result = this._parser."+handler+"(content, is_match);"),result},WYMeditor.Lexer.prototype._reduce=function(e){var t=this._regexes[this._mode.getCurrent()].match(e),n=t[1],r=t[0];if(r){var i=e.indexOf(n),s=e.substr(0,i);return e=e.substring(i+n.length),[e,s,n,r]}return!0},WYMeditor.XhtmlLexer=function(e){return $.extend(this,new WYMeditor.Lexer(e,"Text")),this.mapHandler("Text","Text"),this.addTokens(),this.init(),this},WYMeditor.XhtmlLexer.prototype.init=function(){},WYMeditor.XhtmlLexer.prototype.addTokens=function(){this.addCommentTokens("Text"),this.addScriptTokens("Text"),this.addCssTokens("Text"),this.addTagTokens("Text")},WYMeditor.XhtmlLexer.prototype.addCommentTokens=function(e){this.addEntryPattern("<!--",e,"Comment"),this.addExitPattern("-->","Comment")},WYMeditor.XhtmlLexer.prototype.addScriptTokens=function(e){this.addEntryPattern("<script",e,"Script"),this.addExitPattern("</script>","Script")},WYMeditor.XhtmlLexer.prototype.addCssTokens=function(e){this.addEntryPattern("<style",e,"Css"),this.addExitPattern("</style>","Css")},WYMeditor.XhtmlLexer.prototype.addTagTokens=function(e){this.addSpecialPattern("<\\s*[a-z0-9:-]+\\s*>",e,"OpeningTag"),this.addEntryPattern("<[a-z0-9:-]+[\\/ \\>]+",e,"OpeningTag"),this.addInTagDeclarationTokens("OpeningTag"),this.addSpecialPattern("</\\s*[a-z0-9:-]+\\s*>",e,"ClosingTag")},WYMeditor.XhtmlLexer.prototype.addInTagDeclarationTokens=function(e){this.addSpecialPattern("\\s+",e,"Ignore"),this.addAttributeTokens(e),this.addExitPattern("/>",e),this.addExitPattern(">",e)},WYMeditor.XhtmlLexer.prototype.addAttributeTokens=function(e){this.addSpecialPattern("\\s*[a-z-_0-9]*:?[a-z-_0-9]+\\s*(?==)\\s*",e,"TagAttributes"),this.addEntryPattern('=\\s*"',e,"DoubleQuotedAttribute"),this.addPattern('\\\\"',"DoubleQuotedAttribute"),this.addExitPattern('"',"DoubleQuotedAttribute"),this.addEntryPattern("=\\s*'",e,"SingleQuotedAttribute"),this.addPattern("\\\\'","SingleQuotedAttribute"),this.addExitPattern("'","SingleQuotedAttribute"),this.addSpecialPattern("=\\s*[^>\\s]*",e,"UnquotedAttribute")},WYMeditor.XhtmlParser=function(e,t){var t=t||"Text";return this._Lexer=new WYMeditor.XhtmlLexer(this),this._Listener=e,this._mode=t,this._matches=[],this._last_match="",this._current_match="",this},WYMeditor.XhtmlParser.prototype.parse=function(e){return this._Lexer.parse(this.beforeParsing(e)),this.afterParsing(this._Listener.getResult())},WYMeditor.XhtmlParser.prototype.beforeParsing=function(e){return(e.match(/class="MsoNormal"/)||e.match(/ns = "urn:schemas-microsoft-com/))&&this._Listener.avoidStylingTagsAndAttributes(),this._Listener.beforeParsing(e)},WYMeditor.XhtmlParser.prototype.afterParsing=function(e){return this._Listener._avoiding_tags_implicitly&&this._Listener.allowStylingTagsAndAttributes(),this._Listener.afterParsing(e)},WYMeditor.XhtmlParser.prototype.Ignore=function(e,t){return!0},WYMeditor.XhtmlParser.prototype.Text=function(e){return this._Listener.addContent(e),!0},WYMeditor.XhtmlParser.prototype.Comment=function(e,t){return this._addNonTagBlock(e,t,"addComment")},WYMeditor.XhtmlParser.prototype.Script=function(e,t){return this._addNonTagBlock(e,t,"addScript")},WYMeditor.XhtmlParser.prototype.Css=function(e,t){return this._addNonTagBlock(e,t,"addCss")},WYMeditor.XhtmlParser.prototype._addNonTagBlock=function(e,t,n){switch(t){case WYMeditor.LEXER_ENTER:this._non_tag=e;break;case WYMeditor.LEXER_UNMATCHED:this._non_tag+=e;break;case WYMeditor.LEXER_EXIT:switch(n){case"addComment":this._Listener.addComment(this._non_tag+e);break;case"addScript":this._Listener.addScript(this._non_tag+e);break;case"addCss":this._Listener.addCss(this._non_tag+e)}}return!0},WYMeditor.XhtmlParser.prototype.OpeningTag=function(e,t){switch(t){case WYMeditor.LEXER_ENTER:this._tag=this.normalizeTag(e),this._tag_attributes={};break;case WYMeditor.LEXER_SPECIAL:this._callOpenTagListener(this.normalizeTag(e));break;case WYMeditor.LEXER_EXIT:this._callOpenTagListener(this._tag,this._tag_attributes)}return!0},WYMeditor.XhtmlParser.prototype.ClosingTag=function(e,t){return this._callCloseTagListener(this.normalizeTag(e)),!0},WYMeditor.XhtmlParser.prototype._callOpenTagListener=function(e,t){var t=t||{};this.autoCloseUnclosedBeforeNewOpening(e),this._Listener.isBlockTag(e)?(this._Listener._tag_stack.push(e),this._Listener.fixNestingBeforeOpeningBlockTag(e,t),this._Listener.openBlockTag(e,t),this._increaseOpenTagCounter(e)):this._Listener.isInlineTag(e)?this._Listener.inlineTag(e,t):(this._Listener.openUnknownTag(e,t),this._increaseOpenTagCounter(e)),this._Listener.last_tag=e,this._Listener.last_tag_opened=!0,this._Listener.last_tag_attributes=t},WYMeditor.XhtmlParser.prototype._callCloseTagListener=function(e){if(this._decreaseOpenTagCounter(e)){this.autoCloseUnclosedBeforeTagClosing(e);if(this._Listener.isBlockTag(e)){var t=this._Listener._tag_stack.pop();if(t==0)return;t!=e&&(e=t),this._Listener.closeBlockTag(e)}else this._Listener.closeUnknownTag(e)}else this._Listener.closeUnopenedTag(e);this._Listener.last_tag=e,this._Listener.last_tag_opened=!1},WYMeditor.XhtmlParser.prototype._increaseOpenTagCounter=function(e){this._Listener._open_tags[e]=this._Listener._open_tags[e]||0,this._Listener._open_tags[e]++},WYMeditor.XhtmlParser.prototype._decreaseOpenTagCounter=function(e){return this._Listener._open_tags[e]?(this._Listener._open_tags[e]--,this._Listener._open_tags[e]==0&&(this._Listener._open_tags[e]=undefined),!0):!1},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeNewOpening=function(e){this._autoCloseUnclosed(e,!1)},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeTagClosing=function(e){this._autoCloseUnclosed(e,!0)},WYMeditor.XhtmlParser.prototype._autoCloseUnclosed=function(e,t){var t=t||!1;if(this._Listener._open_tags)for(var n in this._Listener._open_tags){var r=this._Listener._open_tags[n];r>0&&this._Listener.shouldCloseTagAutomatically(n,e,t)&&this._callCloseTagListener(n,!0)}},WYMeditor.XhtmlParser.prototype.getTagReplacements=function(){return this._Listener.getTagReplacements()},WYMeditor.XhtmlParser.prototype.normalizeTag=function(e){e=e.replace(/^([\s<\/>]*)|([\s<\/>]*)$/gm,"").toLowerCase();var t=this._Listener.getTagReplacements();return t[e]?t[e]:e},WYMeditor.XhtmlParser.prototype.TagAttributes=function(e,t){return WYMeditor.LEXER_SPECIAL==t&&(this._current_attribute=e),!0},WYMeditor.XhtmlParser.prototype.DoubleQuotedAttribute=function(e,t){return WYMeditor.LEXER_UNMATCHED==t&&(this._tag_attributes[this._current_attribute]=e),!0},WYMeditor.XhtmlParser.prototype.SingleQuotedAttribute=function(e,t){return WYMeditor.LEXER_UNMATCHED==t&&(this._tag_attributes[this._current_attribute]=e),!0},WYMeditor.XhtmlParser.prototype.UnquotedAttribute=function(e,t){return this._tag_attributes[this._current_attribute]=e.replace(/^=/,""),!0},WYMeditor.XhtmlSaxListener=function(){return this.output="",this.helper=new WYMeditor.XmlHelper,this._open_tags={},this.validator=WYMeditor.XhtmlValidator,this._tag_stack=[],this.avoided_tags=["area"],this.entities={"&nbsp;":"&#160;","&iexcl;":"&#161;","&cent;":"&#162;","&pound;":"&#163;","&curren;":"&#164;","&yen;":"&#165;","&brvbar;":"&#166;","&sect;":"&#167;","&uml;":"&#168;","&copy;":"&#169;","&ordf;":"&#170;","&laquo;":"&#171;","&not;":"&#172;","&shy;":"&#173;","&reg;":"&#174;","&macr;":"&#175;","&deg;":"&#176;","&plusmn;":"&#177;","&sup2;":"&#178;","&sup3;":"&#179;","&acute;":"&#180;","&micro;":"&#181;","&para;":"&#182;","&middot;":"&#183;","&cedil;":"&#184;","&sup1;":"&#185;","&ordm;":"&#186;","&raquo;":"&#187;","&frac14;":"&#188;","&frac12;":"&#189;","&frac34;":"&#190;","&iquest;":"&#191;","&Agrave;":"&#192;","&Aacute;":"&#193;","&Acirc;":"&#194;","&Atilde;":"&#195;","&Auml;":"&#196;","&Aring;":"&#197;","&AElig;":"&#198;","&Ccedil;":"&#199;","&Egrave;":"&#200;","&Eacute;":"&#201;","&Ecirc;":"&#202;","&Euml;":"&#203;","&Igrave;":"&#204;","&Iacute;":"&#205;","&Icirc;":"&#206;","&Iuml;":"&#207;","&ETH;":"&#208;","&Ntilde;":"&#209;","&Ograve;":"&#210;","&Oacute;":"&#211;","&Ocirc;":"&#212;","&Otilde;":"&#213;","&Ouml;":"&#214;","&times;":"&#215;","&Oslash;":"&#216;","&Ugrave;":"&#217;","&Uacute;":"&#218;","&Ucirc;":"&#219;","&Uuml;":"&#220;","&Yacute;":"&#221;","&THORN;":"&#222;","&szlig;":"&#223;","&agrave;":"&#224;","&aacute;":"&#225;","&acirc;":"&#226;","&atilde;":"&#227;","&auml;":"&#228;","&aring;":"&#229;","&aelig;":"&#230;","&ccedil;":"&#231;","&egrave;":"&#232;","&eacute;":"&#233;","&ecirc;":"&#234;","&euml;":"&#235;","&igrave;":"&#236;","&iacute;":"&#237;","&icirc;":"&#238;","&iuml;":"&#239;","&eth;":"&#240;","&ntilde;":"&#241;","&ograve;":"&#242;","&oacute;":"&#243;","&ocirc;":"&#244;","&otilde;":"&#245;","&ouml;":"&#246;","&divide;":"&#247;","&oslash;":"&#248;","&ugrave;":"&#249;","&uacute;":"&#250;","&ucirc;":"&#251;","&uuml;":"&#252;","&yacute;":"&#253;","&thorn;":"&#254;","&yuml;":"&#255;","&OElig;":"&#338;","&oelig;":"&#339;","&Scaron;":"&#352;","&scaron;":"&#353;","&Yuml;":"&#376;","&fnof;":"&#402;","&circ;":"&#710;","&tilde;":"&#732;","&Alpha;":"&#913;","&Beta;":"&#914;","&Gamma;":"&#915;","&Delta;":"&#916;","&Epsilon;":"&#917;","&Zeta;":"&#918;","&Eta;":"&#919;","&Theta;":"&#920;","&Iota;":"&#921;","&Kappa;":"&#922;","&Lambda;":"&#923;","&Mu;":"&#924;","&Nu;":"&#925;","&Xi;":"&#926;","&Omicron;":"&#927;","&Pi;":"&#928;","&Rho;":"&#929;","&Sigma;":"&#931;","&Tau;":"&#932;","&Upsilon;":"&#933;","&Phi;":"&#934;","&Chi;":"&#935;","&Psi;":"&#936;","&Omega;":"&#937;","&alpha;":"&#945;","&beta;":"&#946;","&gamma;":"&#947;","&delta;":"&#948;","&epsilon;":"&#949;","&zeta;":"&#950;","&eta;":"&#951;","&theta;":"&#952;","&iota;":"&#953;","&kappa;":"&#954;","&lambda;":"&#955;","&mu;":"&#956;","&nu;":"&#957;","&xi;":"&#958;","&omicron;":"&#959;","&pi;":"&#960;","&rho;":"&#961;","&sigmaf;":"&#962;","&sigma;":"&#963;","&tau;":"&#964;","&upsilon;":"&#965;","&phi;":"&#966;","&chi;":"&#967;","&psi;":"&#968;","&omega;":"&#969;","&thetasym;":"&#977;","&upsih;":"&#978;","&piv;":"&#982;","&ensp;":"&#8194;","&emsp;":"&#8195;","&thinsp;":"&#8201;","&zwnj;":"&#8204;","&zwj;":"&#8205;","&lrm;":"&#8206;","&rlm;":"&#8207;","&ndash;":"&#8211;","&mdash;":"&#8212;","&lsquo;":"&#8216;","&rsquo;":"&#8217;","&sbquo;":"&#8218;","&ldquo;":"&#8220;","&rdquo;":"&#8221;","&bdquo;":"&#8222;","&dagger;":"&#8224;","&Dagger;":"&#8225;","&bull;":"&#8226;","&hellip;":"&#8230;","&permil;":"&#8240;","&prime;":"&#8242;","&Prime;":"&#8243;","&lsaquo;":"&#8249;","&rsaquo;":"&#8250;","&oline;":"&#8254;","&frasl;":"&#8260;","&euro;":"&#8364;","&image;":"&#8465;","&weierp;":"&#8472;","&real;":"&#8476;","&trade;":"&#8482;","&alefsym;":"&#8501;","&larr;":"&#8592;","&uarr;":"&#8593;","&rarr;":"&#8594;","&darr;":"&#8595;","&harr;":"&#8596;","&crarr;":"&#8629;","&lArr;":"&#8656;","&uArr;":"&#8657;","&rArr;":"&#8658;","&dArr;":"&#8659;","&hArr;":"&#8660;","&forall;":"&#8704;","&part;":"&#8706;","&exist;":"&#8707;","&empty;":"&#8709;","&nabla;":"&#8711;","&isin;":"&#8712;","&notin;":"&#8713;","&ni;":"&#8715;","&prod;":"&#8719;","&sum;":"&#8721;","&minus;":"&#8722;","&lowast;":"&#8727;","&radic;":"&#8730;","&prop;":"&#8733;","&infin;":"&#8734;","&ang;":"&#8736;","&and;":"&#8743;","&or;":"&#8744;","&cap;":"&#8745;","&cup;":"&#8746;","&int;":"&#8747;","&there4;":"&#8756;","&sim;":"&#8764;","&cong;":"&#8773;","&asymp;":"&#8776;","&ne;":"&#8800;","&equiv;":"&#8801;","&le;":"&#8804;","&ge;":"&#8805;","&sub;":"&#8834;","&sup;":"&#8835;","&nsub;":"&#8836;","&sube;":"&#8838;","&supe;":"&#8839;","&oplus;":"&#8853;","&otimes;":"&#8855;","&perp;":"&#8869;","&sdot;":"&#8901;","&lceil;":"&#8968;","&rceil;":"&#8969;","&lfloor;":"&#8970;","&rfloor;":"&#8971;","&lang;":"&#9001;","&rang;":"&#9002;","&loz;":"&#9674;","&spades;":"&#9824;","&clubs;":"&#9827;","&hearts;":"&#9829;","&diams;":"&#9830;"},this.block_tags=["a","abbr","acronym","address","area","b","base","bdo","big","blockquote","body","button","caption","cite","code","col","colgroup","dd","del","div","dfn","dl","dt","em","fieldset","form","head","h1","h2","h3","h4","h5","h6","html","i","iframe","ins","kbd","label","legend","li","map","noscript","object","ol","optgroup","option","p","pre","q","samp","script","select","small","span","strong","style","sub","sup","table","tbody","td","textarea","tfoot","th","thead","title","tr","tt","ul","var","extends","meter","section","article","aside","details","header","footer","nav","dialog","figure","figcaption","address","hgroup","mark","time","canvas","audio","video","source","output","progress","ruby","rt","rp","summary","command"],this.inline_tags=["br","embed","hr","img","input","param","source","wbr"],this},WYMeditor.XhtmlSaxListener.prototype.shouldCloseTagAutomatically=function(e,t,n){var n=n||!1;if(e=="td")if(n&&t=="tr"||!n&&t=="td")return!0;if(e=="option")if(n&&t=="select"||!n&&t=="option")return!0;return!1},WYMeditor.XhtmlSaxListener.prototype.beforeParsing=function(e){return this.output="",e},WYMeditor.XhtmlSaxListener.prototype.afterParsing=function(e){return e=this.replaceNamedEntities(e),e=this.joinRepeatedEntities(e),e=this.removeEmptyTags(e),e},WYMeditor.XhtmlSaxListener.prototype.replaceNamedEntities=function(e){for(var t in this.entities)e=e.replace(new RegExp(t,"g"),this.entities[t]);return e},WYMeditor.XhtmlSaxListener.prototype.joinRepeatedEntities=function(e){var t="em|strong|sub|sup|acronym|pre|del|address";return e.replace(new RegExp("</("+t+")><\\1>",""),"").replace(new RegExp("(s*<("+t+")>s*){2}(.*)(s*</\\2>s*){2}",""),"<$2>$3<$2>")},WYMeditor.XhtmlSaxListener.prototype.removeEmptyTags=function(e){return e.replace(new RegExp("<("+this.block_tags.join("|").replace(/\|td/,"").replace(/\|th/,"")+")>(<br />|&#160;|&nbsp;|\\s)*</\\1>","g"),"")},WYMeditor.XhtmlSaxListener.prototype.removeBrInPre=function(e){var t=e.match(new RegExp("<pre[^>]*>(.*?)</pre>","gmi"));if(t)for(var n=0;n<t.length;n++)e=e.replace(t[n],t[n].replace(new RegExp("<br />","g"),String.fromCharCode(13,10)));return e},WYMeditor.XhtmlSaxListener.prototype.getResult=function(){return this.output},WYMeditor.XhtmlSaxListener.prototype.getTagReplacements=function(){return{b:"strong",i:"em"}},WYMeditor.XhtmlSaxListener.prototype.addContent=function(e){this.output+=e},WYMeditor.XhtmlSaxListener.prototype.addComment=function(e){this.remove_comments&&(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.addScript=function(e){this.remove_scripts||(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.addCss=function(e){this.remove_embeded_styles||(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.openBlockTag=function(e,t){this.output+=this.helper.tag(e,this.validator.getValidTagAttributes(e,t),!0)},WYMeditor.XhtmlSaxListener.prototype.inlineTag=function(e,t){this.output+=this.helper.tag(e,this.validator.getValidTagAttributes(e,t))},WYMeditor.XhtmlSaxListener.prototype.openUnknownTag=function(e,t){e==="area"&&(this.output+=this.helper.tag(e,t,!0))},WYMeditor.XhtmlSaxListener.prototype.closeBlockTag=function(e){this.output=this.output.replace(/<br \/>$/,"")+this._getClosingTagContent("before",e)+"</"+e+">"+this._getClosingTagContent("after",e)},WYMeditor.XhtmlSaxListener.prototype.closeUnknownTag=function(e){},WYMeditor.XhtmlSaxListener.prototype.closeUnopenedTag=function(e){this.output+="</"+e+">"},WYMeditor.XhtmlSaxListener.prototype.avoidStylingTagsAndAttributes=function(){this.avoided_tags=["div","span"],this.validator.skipped_attributes=["style"],this.validator.skipped_attribute_values=["MsoNormal","main1"],this._avoiding_tags_implicitly=!0},WYMeditor.XhtmlSaxListener.prototype.allowStylingTagsAndAttributes=function(){this.avoided_tags=[],this.validator.skipped_attributes=[],this.validator.skipped_attribute_values=[],this._avoiding_tags_implicitly=!1},WYMeditor.XhtmlSaxListener.prototype.isBlockTag=function(e){return!WYMeditor.Helper.contains(this.avoided_tags,e)&&WYMeditor.Helper.contains(this.block_tags,e)},WYMeditor.XhtmlSaxListener.prototype.isInlineTag=function(e){return!WYMeditor.Helper.contains(this.avoided_tags,e)&&WYMeditor.Helper.contains(this.inline_tags,e)},WYMeditor.XhtmlSaxListener.prototype.insertContentAfterClosingTag=function(e,t){this._insertContentWhenClosingTag("after",e,t)},WYMeditor.XhtmlSaxListener.prototype.insertContentBeforeClosingTag=function(e,t){this._insertContentWhenClosingTag("before",e,t)},WYMeditor.XhtmlSaxListener.prototype.fixNestingBeforeOpeningBlockTag=function(e,t){e!="li"&&(e=="ul"||e=="ol")&&this.last_tag&&!this.last_tag_opened&&this.last_tag=="li"&&(this.output=this.output.replace(/<\/li>$/,""),this.insertContentAfterClosingTag(e,"</li>"))},WYMeditor.XhtmlSaxListener.prototype._insertContentWhenClosingTag=function(e,t,n){this["_insert_"+e+"_closing"]||(this["_insert_"+e+"_closing"]=[]),this["_insert_"+e+"_closing"][t]||(this["_insert_"+e+"_closing"][t]=[]),this["_insert_"+e+"_closing"][t].push(n)},WYMeditor.XhtmlSaxListener.prototype._getClosingTagContent=function(e,t){return this["_insert_"+e+"_closing"]&&this["_insert_"+e+"_closing"][t]&&this["_insert_"+e+"_closing"][t].length>0?this["_insert_"+e+"_closing"][t].pop():""},WYMeditor.WymCssLexer=function(e,t){var t=typeof t=="undefined"?!0:t;return $.extend(this,new WYMeditor.Lexer(e,t?"Ignore":"WymCss")),this.mapHandler("WymCss","Ignore"),t==1&&(this.addEntryPattern("/\\*[<\\s]*WYMeditor[>\\s]*\\*/","Ignore","WymCss"),this.addExitPattern("/\\*[</\\s]*WYMeditor[>\\s]*\\*/","WymCss")),this.addSpecialPattern("[\\sa-z1-6]*\\.[a-z-_0-9]+","WymCss","WymCssStyleDeclaration"),this.addEntryPattern("/\\*","WymCss","WymCssComment"),this.addExitPattern("\\*/","WymCssComment"),this.addEntryPattern("{","WymCss","WymCssStyle"),this.addExitPattern("}","WymCssStyle"),this.addEntryPattern("/\\*","WymCssStyle","WymCssFeedbackStyle"),this.addExitPattern("\\*/","WymCssFeedbackStyle"),this},WYMeditor.WymCssParser=function(){return this._in_style=!1,this._has_title=!1,this.only_wym_blocks=!0,this.css_settings={classesItems:[],editorStyles:[],dialogStyles:[]},this},WYMeditor.WymCssParser.prototype.parse=function(e,t){var t=typeof t=="undefined"?this.only_wym_blocks:t;this._Lexer=new WYMeditor.WymCssLexer(this,t),this._Lexer.parse(e)},WYMeditor.WymCssParser.prototype.Ignore=function(e,t){return!0},WYMeditor.WymCssParser.prototype.WymCssComment=function(e,t){return e.match(/end[a-z0-9\s]*wym[a-z0-9\s]*/mi)?!1:(t==WYMeditor.LEXER_UNMATCHED&&(this._in_style?this._current_item[this._current_element]&&(this._current_item[this._current_element].expressions?this._current_item[this._current_element].expressions.push(e):this._current_item[this._current_element].expressions=[e]):(this._has_title=!0,this._current_item={title:WYMeditor.Helper.trim(e)}),this._in_style=!0),!0)},WYMeditor.WymCssParser.prototype.WymCssStyle=function(e,t){return t==WYMeditor.LEXER_UNMATCHED?(e=WYMeditor.Helper.trim(e),e!=""&&(this._current_item[this._current_element].style=e)):t==WYMeditor.LEXER_EXIT&&(this._in_style=!1,this._has_title=!1,this.addStyleSetting(this._current_item)),!0},WYMeditor.WymCssParser.prototype.WymCssFeedbackStyle=function(e,t){return t==WYMeditor.LEXER_UNMATCHED&&(this._current_item[this._current_element].feedback_style=e.replace(/^([\s\/\*]*)|([\s\/\*]*)$/gm,"")),!0},WYMeditor.WymCssParser.prototype.WymCssStyleDeclaration=function(e){e=e.replace(/^([\s\.]*)|([\s\.*]*)$/gm,"");var t="";if(e.indexOf(".")>0){var n=e.split(".");this._current_element=n[1];var t=n[0]}else this._current_element=e;return this._has_title||(this._current_item={title:(t?t.toUpperCase()+": ":"")+this._current_element},this._has_title=!0),this._current_item[this._current_element]||(this._current_item[this._current_element]={name:this._current_element}),t&&(this._current_item[this._current_element].tags?this._current_item[this._current_element].tags.push(t):this._current_item[this._current_element].tags=[t]),!0},WYMeditor.WymCssParser.prototype.addStyleSetting=function(e){for(var t in e){var n=e[t];typeof n=="object"&&t!="title"&&(this.css_settings.classesItems.push({name:WYMeditor.Helper.trim(n.name),title:e.title,expr:WYMeditor.Helper.trim((n.expressions||n.tags).join(", "))}),n.feedback_style&&this.css_settings.editorStyles.push({name:"."+WYMeditor.Helper.trim(n.name),css:n.feedback_style}),n.style&&this.css_settings.dialogStyles.push({name:"."+WYMeditor.Helper.trim(n.name),css:n.style}))}},$.fn.isPhantomNode=function(){return this[0].nodeType==3?!/[^\t\n\r ]/.test(this[0].data):!1},WYMeditor.isPhantomNode=function(e){return e.nodeType==3?!/[^\t\n\r ]/.test(e.data):!1},WYMeditor.isPhantomString=function(e){return!/[^\t\n\r ]/.test(e)},$.fn.parentsOrSelf=function(e){var t=this;return t[0].nodeType==3&&(t=t.parents().slice(0,1)),t.filter(e).size()==1?t:t.parents(e).slice(0,1)},WYMeditor.Helper={replaceAll:function(e,t,n){return e.replace(new RegExp
(t,"g"),n)},insertAt:function(e,t,n){return e.substr(0,n)+t+e.substring(n)},trim:function(e){return e.replace(/^(\s*)|(\s*)$/gm,"")},contains:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},indexOf:function(e,t){var n=-1;for(var r=0;r<e.length;r++)if(e[r]==t){n=r;break}return n},findByName:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.name==t)return r}return null}},WYMeditor.XhtmlValidator={_attributes:{core:{except:["base","head","html","meta","param","script","style","title"],attributes:["class","id","style","title","accesskey","tabindex","data","^data-.*"]},language:{except:["base","br","hr","iframe","param","script"],attributes:{dir:["ltr","rtl"],0:"lang",1:"xml:lang"}},keyboard:{attributes:{accesskey:/^(\w){1}$/,tabindex:/^(\d)+$/}}},_events:{window:{only:["body"],attributes:["onload","onunload"]},form:{only:["form","input","textarea","select","a","label","button"],attributes:["onchange","onsubmit","onreset","onselect","onblur","onfocus"]},keyboard:{except:["base","bdo","br","frame","frameset","head","html","iframe","meta","param","script","style","title"],attributes:["onkeydown","onkeypress","onkeyup"]},mouse:{except:["base","bdo","br","head","html","meta","param","script","style","title"],attributes:["onclick","ondblclick","onmousedown","onmousemove","onmouseover","onmouseout","onmouseup"]}},_tags:{a:{attributes:{0:"charset",1:"coords",2:"href",3:"hreflang",4:"name",rel:/^(alternate|designates|stylesheet|start|next|nofollow|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon|moodalbox)+$/,rev:/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon|moodalbox)+$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/,5:"type",target:/^(_blank)+$/}},0:"abbr",1:"acronym",2:"address",area:{attributes:{0:"alt",1:"coords",2:"href",nohref:/^(true|false)$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/},required:["alt"]},3:"b",base:{attributes:["href"],required:["href"]},bdo:{attributes:{dir:/^(ltr|rtl)$/},required:["dir"]},4:"big",blockquote:{attributes:["cite"]},5:"body",6:"br",button:{attributes:{disabled:/^(disabled)$/,type:/^(button|reset|submit)$/,0:"value"},inside:"form"},7:"caption",8:"cite",9:"code",col:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"},inside:"colgroup"},colgroup:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"}},10:"dd",del:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},11:"div",12:"dfn",13:"dl",14:"dt",15:"em",fieldset:{inside:"form"},form:{attributes:{0:"action",1:"accept",2:"accept-charset",3:"enctype",method:/^(get|post)$/},required:["action"]},head:{attributes:["profile"]},16:"h1",17:"h2",18:"h3",19:"h4",20:"h5",21:"h6",22:"hr",html:{attributes:["xmlns"]},23:"i",iframe:{attributes:["src","width","height","frameborder","scrolling","marginheight","marginwidth"],required:["src"]},img:{attributes:{align:/^(right|left|center|justify)$/,0:"alt",1:"src",2:"height",3:"ismap",4:"longdesc",5:"usemap",6:"width",7:"rel"},required:["alt","src"]},input:{attributes:{0:"accept",1:"alt",checked:/^(checked)$/,disabled:/^(disabled)$/,maxlength:/^(\d)+$/,2:"name",readonly:/^(readonly)$/,size:/^(\d)+$/,3:"src",type:/^(button|checkbox|file|hidden|image|password|radio|reset|submit|text|tel|search|url|email|datetime|date|month|week|time|datetime-local|number|range|color|placeholder)$/,4:"value"},inside:"form"},ins:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},24:"kbd",label:{attributes:["for"],inside:"form"},25:"legend",26:"li",link:{attributes:{0:"charset",1:"href",2:"hreflang",media:/^(all|braille|print|projection|screen|speech|,|;| )+$/i,rel:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|nofollow|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,rev:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,3:"type"},inside:"head"},map:{attributes:["id","name"],required:["id"]},meta:{attributes:{0:"content","http-equiv":/^(content\-type|expires|refresh|set\-cookie)$/i,1:"name",2:"scheme"},required:["content"]},27:"noscript",28:"ol",optgroup:{attributes:{0:"label",disabled:/^(disabled)$/},required:["label"]},option:{attributes:{0:"label",disabled:/^(disabled)$/,selected:/^(selected)$/,1:"value"},inside:"select"},29:"p",param:{attributes:["type","value","name"],required:["name"],inside:"object"},embed:{attributes:["width","height","allowfullscreen","allowscriptaccess","wmode","type","src","flashvars"],inside:"object"},object:{attributes:["archive","classid","codebase","codetype","data","declare","height","name","standby","type","usemap","width"]},30:"pre",q:{attributes:["cite"]},31:"samp",script:{attributes:{type:/^(text\/ecmascript|text\/javascript|text\/jscript|text\/vbscript|text\/vbs|text\/xml)$/,0:"charset",defer:/^(defer)$/,1:"src"},required:["type"]},select:{attributes:{disabled:/^(disabled)$/,multiple:/^(multiple)$/,0:"name",1:"size"},inside:"form"},32:"small",33:"span",34:"strong",style:{attributes:{0:"type",media:/^(screen|tty|tv|projection|handheld|print|braille|aural|all)$/},required:["type"]},35:"sub",36:"sup",table:{attributes:{0:"border",1:"cellpadding",2:"cellspacing",frame:/^(void|above|below|hsides|lhs|rhs|vsides|box|border)$/,rules:/^(none|groups|rows|cols|all)$/,3:"summary",4:"width"}},tbody:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},td:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},textarea:{attributes:["cols","rows","disabled","name","readonly"],required:["cols","rows"],inside:"form"},tfoot:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom)$/,2:"baseline"}},th:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},thead:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},37:"title",tr:{attributes:{align:/^(right|left|center|justify|char)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},38:"tt",39:"ul",40:"var",41:"section",42:"article",43:"aside",44:"details",45:"header",46:"footer",47:"nav",48:"dialog",49:"figure",50:"figcaption",51:"address",52:"hgroup",53:"mark",54:"time",55:"canvas",56:"audio",57:"video",58:"source",59:"output",60:"progress",61:"ruby",62:"rt",63:"rp",64:"summary",65:"command"},skipped_attributes:[],skipped_attribute_values:[],getValidTagAttributes:function(e,t){var n={},r=this.getPossibleTagAttributes(e),i=[];$.each(r||[],function(e,t){t.indexOf("*")>-1&&i.push(new RegExp(t))});var s=WYMeditor.Helper;for(var o in t){var u=t[o];!s.contains(this.skipped_attributes,o)&&!s.contains(this.skipped_attribute_values,u)&&typeof u!="function"&&(s.contains(r,o)?this.doesAttributeNeedsValidation(e,o)?this.validateAttribute(e,o,u)&&(n[o]=u):n[o]=u:$.each(i,function(e,t){o.match(t)&&(n[o]=u)}))}return n},getUniqueAttributesAndEventsForTag:function(e){var t=[];if(this._tags[e]&&this._tags[e].attributes)for(k in this._tags[e].attributes)t.push(parseInt(k)==k?this._tags[e].attributes[k]:k);return t},getDefaultAttributesAndEventsForTags:function(){var e=[];for(var t in this._events)e.push(this._events[t]);for(var t in this._attributes)e.push(this._attributes[t]);return e},isValidTag:function(e){if(this._tags[e])return!0;for(var t in this._tags)if(this._tags[t]==e)return!0;return!1},getDefaultAttributesAndEventsForTag:function(e){var t=[];if(this.isValidTag(e)){var n=this.getDefaultAttributesAndEventsForTags();for(var r in n){var i=n[r];if(typeof i=="object"){var s=WYMeditor.Helper;if(i.except&&s.contains(i.except,e)||i.only&&!s.contains(i.only,e))continue;var o=i.attributes?i.attributes:i.events;for(var u in o)t.push(typeof o[u]!="string"?u:o[u])}}}return t},doesAttributeNeedsValidation:function(e,t){return this._tags[e]&&(this._tags[e].attributes&&this._tags[e].attributes[t]||this._tags[e].required&&WYMeditor.Helper.contains(this._tags[e].required,t))},validateAttribute:function(e,t,n){return this._tags[e]&&this._tags[e].attributes&&this._tags[e].attributes[t]&&n.length>0&&!n.match(this._tags[e].attributes[t])||this._tags[e]&&this._tags[e].required&&WYMeditor.Helper.contains(this._tags[e].required,t)&&n.length==0?!1:typeof this._tags[e]!="undefined"},getPossibleTagAttributes:function(e){return this._possible_tag_attributes||(this._possible_tag_attributes={}),this._possible_tag_attributes[e]||(this._possible_tag_attributes[e]=this.getUniqueAttributesAndEventsForTag(e).concat(this.getDefaultAttributesAndEventsForTag(e))),this._possible_tag_attributes[e]}},WYMeditor.WymClassExplorer=function(e){this._wym=e,this._class="className",this._newLine="\r\n"},WYMeditor.WymClassExplorer.prototype.format_block=function(e){var t=this,n=e||t.selected()||$(t._iframe).contents().find("body").get(0),r=n.tagName.toLowerCase();$.inArray(r,["strong","b","em","i","sub","sup","a"])>-1&&(r=n.parentNode.tagName.toLowerCase()),r==WYMeditor.BODY&&(t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),t._exec(WYMeditor.FORMAT_BLOCK,"<"+WYMeditor.P+">"))},WYMeditor.WymClassExplorer.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),$("html",this._doc).addClass("ie"),$(this._doc.body).html(this._wym._html);var wym=this;this._doc.body.onfocus=function(){wym._doc.designMode="on",wym._doc=iframe.contentWindow.document},this._doc.onbeforedeactivate=function(){wym.saveCaret()},this._doc.onkeyup=function(){wym.saveCaret(),wym.keyup()},this._doc.onclick=function(){wym.saveCaret()},this._doc.body.onbeforepaste=function(){wym._iframe.contentWindow.event.returnValue=!1},this._doc.body.onpaste=function(){wym._iframe.contentWindow.event.returnValue=!1,wym.paste(window.clipboardData.getData("Text"))},this._initialized&&($.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()),this._initialized=!0,this._doc.designMode="on";try{this._doc=iframe.contentWindow.document}catch(e){}},WYMeditor.WymClassExplorer.prototype._exec=function(e,t){var n=this;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var r=n.findUp(n.container(),WYMeditor.LI);if(r){var i=r.parentNode.parentNode;(r.parentNode.childNodes.length>1||$.inArray(i.tagName.toLowerCase(),[WYMeditor.OL,WYMeditor.UL])>-1)&&n._doc.execCommand(e)}break;default:t?n._doc.execCommand(e,!1,t):n._doc.execCommand(e)}},WYMeditor.WymClassExplorer.prototype.selected=function(){var e=this._iframe.contentWindow.document.caretPos;if(e!=null&&e.parentElement!=undefined)return e.parentElement()},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.addCssRule=function(e,t){e.addRule(t.name,t.css)},WYMeditor.WymClassExplorer.prototype.insert=function(e){var t=this._doc.selection.createRange();if($(t.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{t.pasteHTML(e)}catch(n){}else this.paste(e)},WYMeditor.WymClassExplorer.prototype.wrap=function(e,t){var n=this._doc.selection.createRange();if($(n.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{n.pasteHTML(e+n.text+t)}catch(r){}},WYMeditor.WymClassExplorer.prototype.unwrap=function(){var e=this._doc.selection.createRange();if($(e.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{var t=e.text;this._exec("Cut"),e.pasteHTML(t)}catch(n){}},WYMeditor.WymClassExplorer.prototype.keyup=function(e){(wym=this)._selected_image=null,$(wym._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),wym.format_block()},WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(e,t){(wym=this)._iframe.contentWindow.focus();var n=wym._doc.selection.createRange();t=t?!0:!1,n.moveToElementText(e),n.collapse(t),n.select(),e.focus()},WYMeditor.WymClassMozilla=function(e){this._wym=e,this._class="class",this._newLine="\n"},WYMeditor.WymClassMozilla.prototype.initIframe=function(iframe){var wym=this;this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),$(".fieldWithErrors iframe").contents().find("body").addClass("fieldWithErrors"),this.html(this._wym._html),this.enableDesignMode(),$.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$(this._doc).bind("keydown",this.keydown),$(this._doc).bind("keyup",this.keyup),$(this._doc).bind("paste",this.intercept_paste),$(this._doc).bind("focus",function(){wym.enableDesignMode.call(wym)}),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassMozilla.prototype.html=function(e){if(typeof e!="string")return $(this._doc.body).html();try{this._doc.designMode="off"}catch(t){}e=e.replace(/<em(\b[^>]*)>/gi,"<i$1>").replace(/<\/em>/gi,"</i>").replace(/<strong(\b[^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>"),$(this._doc.body).html(e),this.enableDesignMode()},WYMeditor.WymClassMozilla.prototype._exec=function(e,t){if(!this.selected())return!1;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var n=this.selected(),r=this._iframe.contentWindow.getSelection(),i=r.anchorNode;i.nodeName=="#text"&&(i=i.parentNode),n=this.findUp(n,WYMeditor.BLOCKS),i=this.findUp(i,WYMeditor.BLOCKS);if(n&&n==i&&n.tagName.toLowerCase()==WYMeditor.LI){var s=n.parentNode.parentNode;(n.parentNode.childNodes.length>1||$.inArray(s.tagName.toLowerCase(),[WYMeditor.OL,WYMeditor.UL])>-1)&&this._doc.execCommand(e,"",null)}break;default:t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null)}var o=this.selected();o.tagName.toLowerCase()==WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassMozilla.prototype.selected=function(e){if(e==null||e.toString()!="true")e=!1;var t=this._iframe.contentWindow.getSelection(),n=t.focusNode;if(n){if(n.nodeName=="#text"){if(e&&t.toString().length>0){actual_node=null,parent_node=t.focusNode.parentNode;if(parent_node!=null)for(i=0;i<parent_node.childNodes.length;i++)child_node=parent_node.childNodes[i],child_node.nodeName!="#text"&&child_node.innerHTML==t.toString()&&(actual_node=child_node);return actual_node==null?this.switchTo(t,"span"):actual_node}return n.parentNode}return n}return null},WYMeditor.WymClassMozilla.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassMozilla.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title];if(e.ctrlKey){if(e.keyCode==66)return t._exec(WYMeditor.BOLD),!1;if(e.keyCode==73)return t._exec(WYMeditor.ITALIC),!1}else e.keyCode==13&&(e.shiftKey||(container=t.selected(),container&&container.tagName.toLowerCase()==WYMeditor.PRE&&(e.preventDefault(),t.insert("<p></p>"))))},WYMeditor.WymClassMozilla.prototype.keyup=function(e){if((wym=WYMeditor.INSTANCES[this.title])!=null){wym._selected_image=null,$(wym._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym");var t=null;e.keyCode==13&&!e.shiftKey?($(wym._doc.body).children(WYMeditor.BR).remove(),(t=wym.selected())&&t.tagName.toLowerCase()==WYMeditor.PRE&&wym._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)):$.inArray(e.keyCode,[8,17,46,224])==-1&&!e.metaKey&&!e.ctrlKey&&wym.format_block()}},WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){if(this._doc.designMode=="off")try{this._doc.designMode="on",this._doc.execCommand("styleWithCSS","",!1)}catch(e){}},WYMeditor.WymClassMozilla.prototype.openBlockTag=function(e,t){var t=this.validator.getValidTagAttributes(e,t);if(e=="span"&&t.style){var n=this.getTagForStyle(t.style);if(!n)return;this._tag_stack.pop();var e=n;this._tag_stack.push(n),t.style=""}this.output+=this.helper.tag(e,t,!0)},WYMeditor.WymClassMozilla.prototype.getTagForStyle=function(e){return/bold/.test(e)?"strong":/italic/.test(e)?"em":/sub/.test(e)?"sub":/super/.test(e)?"super":!1},WYMeditor.WymClassOpera=function(e){this._wym=e,this._class="class",this._newLine="\r\n"},WYMeditor.WymClassOpera.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),$.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$(this._doc).bind("keydown",this.keydown),$(this._doc).bind("keyup",this.keyup),$(this._doc).bind("paste",this.intercept_paste),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassOpera.prototype._exec=function(e,t){t?this._doc.execCommand(e,!1,t):this._doc.execCommand(e)},WYMeditor.WymClassOpera.prototype.selected=function(){var e=this._iframe.contentWindow.getSelection(),t=e.focusNode;return t?t.nodeName=="#text"?t.parentNode:t:null},WYMeditor.WymClassOpera.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassOpera.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title],n=t._iframe.contentWindow.getSelection();startNode=n.getRangeAt(0).startContainer,!$(startNode).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]&&!$(startNode).parentsOrSelf("li")&&e.keyCode!=WYMeditor.KEY.ENTER&&e.keyCode!=WYMeditor.KEY.LEFT&&e.keyCode!=WYMeditor.KEY.UP&&e.keyCode!=WYMeditor.KEY.RIGHT&&e.keyCode!=WYMeditor.KEY.DOWN&&e.keyCode!=WYMeditor.KEY.BACKSPACE&&e.keyCode!=WYMeditor.KEY.DELETE&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassOpera.prototype.keyup=function(e){var t=WYMeditor.INSTANCES[this.title];t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym")},WYMeditor.WymClassSafari=function(e){this._wym=e,this._class="class",this._newLine="\n"},WYMeditor.WymClassSafari.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),$.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$(this._doc).bind("keydown",this.keydown),$(this._doc).bind("keyup",this.keyup),$(this._doc).bind("paste",this.intercept_paste),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassSafari.prototype._exec=function(e,t){var n=this;if(!n.selected())return!1;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var r=n.selected(),i=n._iframe.contentWindow.getSelection(),s=i.anchorNode;s.nodeName=="#text"&&(s=s.parentNode),r=n.findUp(r,WYMeditor.BLOCKS),s=n.findUp(s,WYMeditor.BLOCKS);if(r&&r==s&&r.tagName.toLowerCase()==WYMeditor.LI){var o=r.parentNode.parentNode;(r.parentNode.childNodes.length>1||$.inArray(o.tagName.toLowerCase(),[WYMeditor.OL,WYMeditor.UL])>-1)&&n._doc.execCommand(e,"",null)}break;case WYMeditor.INSERT_ORDEREDLIST:case WYMeditor.INSERT_UNORDEREDLIST:this._doc.execCommand(e,"",null);var r=this.selected(),u=this.findUp(r,WYMeditor.MAIN_CONTAINERS);u&&$(u).replaceWith($(u).html());break;default:t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null)}},WYMeditor.WymClassSafari.prototype.selected=function(e){if(e==null||e.toString()!="true")e=!1;var t=this._iframe.contentWindow.getSelection(),n=t.focusNode;if(n){if(n.nodeName=="#text"){if(e&&t.toString().length>0){actual_node=null,parent_node=t.focusNode.parentNode;if(parent_node!=null)for(i=0;i<parent_node.childNodes.length;i++)child_node=parent_node.childNodes[i],child_node.textContent==t.toString()&&(actual_node=child_node.parentNode);return actual_node==null?(this._selected_item=this.switchTo(t,"span"),this._selected_item):actual_node}return n.parentNode}return n}return null},WYMeditor.WymClassSafari.prototype.toggleClass=function(e,t){var n=null;this._selected_image?n=$(this._selected_image):n=$(this.selected(!0)||this._selected_item),t!=null&&(n=$(n.parentsOrSelf(t))),n.toggleClass(e),n.attr(WYMeditor.CLASS)||n.removeAttr(this._class)},WYMeditor.WymClassSafari.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassSafari.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title];e.ctrlKey?(e.keyCode==66&&(t._exec(WYMeditor.BOLD),e.preventDefault()),e.keyCode==73&&(t._exec(WYMeditor.ITALIC),e.preventDefault())):e.shiftKey&&e.keyCode==13&&(t._exec("InsertLineBreak"),e.preventDefault())},WYMeditor.WymClassSafari.prototype.keyup=function(e){var t=WYMeditor.INSTANCES[this.title];t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym");var n=null;e.keyCode==13&&!e.shiftKey?($(t._doc.body).children(WYMeditor.BR).remove(),n=t.selected(),n&&n.tagName.toLowerCase()==WYMeditor.PRE&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)):$.inArray(e.keyCode,[8,17,46,224])==-1&&!e.metaKey&&!e.ctrlKey&&(n=t.selected(),n&&(name=n.tagName.toLowerCase())&&($.inArray(name,["strong","b","em","i","sub","sup","a","span"])>-1&&(name=n.parentNode.tagName.toLowerCase()),$.inArray(name,[WYMeditor.BODY,WYMeditor.DIV])>-1&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)))},WYMeditor.WymClassSafari.prototype.openBlockTag=function(e,t){var t=this.validator.getValidTagAttributes(e,t);if(e=="span"&&t.style){if(!(new_tag=this.getTagForStyle(t.style)))return;this._tag_stack.pop();var e=new_tag;this._tag_stack.push(new_tag),t.style="",typeof t["class"]=="string"&&(t["class"]=t["class"].replace(/apple-style-span/gi,""))}this.output+=this.helper.tag(e,t,!0)},WYMeditor.WymClassSafari.prototype.getTagForStyle=function(e){return/bold/.test(e)?"strong":/italic/.test(e)?"em":/sub/.test(e)?"sub":/super/.test(e)?"sup":!1},onOpenDialog=function(e){(e=$(".ui-dialog")).find(".ui-dialog-titlebar").corner("1px top"),$.browser.msie||e.corner("6px"),e.height()<$(window).height()&&(iframed()?$(parent.document.body).addClass("hide-overflow"):$(document.body).addClass("hide-overflow"))},onCloseDialog=function(e){iframed()?$(parent.document.body).removeClass("hide-overflow"):$(document.body).removeClass("hide-overflow")},WYMeditor.onload_functions=[];var wymeditor_inputs=[],wymeditors_loaded=0;typeof custom_wymeditor_boot_options=="undefined"&&(custom_wymeditor_boot_options={});var form_actions="<div id='dialog-form-actions' class='form-actions'><div class='form-actions-left'><input id='submit_button' class='wym_submit button' type='submit' value='{Insert}' class='button' /><a href='' class='wym_cancel close_dialog button'>{Cancel}</a></div></div>",wymeditor_boot_options=$.extend({skin:"refinery",basePath:"/",wymPath:"/assets/wymeditor/jquery.refinery.wymeditor.js",cssSkinPath:"/assets/wymeditor/skins/",jsSkinPath:"/assets/wymeditor/skins/",langPath:"/assets/wymeditor/lang/",iframeBasePath:"/",classesItems:[{name:"text-align",rules:[{name:"left",title:"{Left}"},{name:"center",title:"{Center}"},{name:"right",title:"{Right}"},{name:"justify",title:"{Justify}"}],join:"-",title:"{Text_Align}"},{name:"image-align",rules:[{name:"left",title:"{Left}"},{name:"right",title:"{Right}"}],join:"-",title:"{Image_Align}"},{name:"font-size",rules:[{name:"small",title:"{Small}"},{name:"normal",title:"{Normal}"},{name:"large",title:"{Large}"}],join:"-",title:"{Font_Size}"}],containersItems:[{name:"h1",title:"Heading_1",css:"wym_containers_h1"},{name:"h2",title:"Heading_2",css:"wym_containers_h2"},{name:"h3",title:"Heading_3",css:"wym_containers_h3"},{name:"p",title:"Paragraph",css:"wym_containers_p"}],toolsItems:[{name:"Bold",title:"Bold",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"}],toolsHtml:"<ul class='wym_tools wym_section wym_buttons'>"+WYMeditor.TOOLS_ITEMS+"</ul>",toolsItemHtml:"<li class='"+WYMeditor.TOOL_CLASS+"'>"+"<a href='#' name='"+WYMeditor.TOOL_NAME+"' title='"+WYMeditor.TOOL_TITLE+"' class='no-tooltip'>"+WYMeditor.TOOL_TITLE+"</a>"+"</li>",classesHtml:"<ul class='wym_classes_container wym_section wym_buttons'><li class='wym_tools_class'><a href='#' name='"+WYMeditor.APPLY_CLASS+"' title='"+WYMeditor.APPLY_CLASS+"' class='no-tooltip'>"+WYMeditor.APPLY_CLASS+"</a>"+"<ul class='wym_classes wym_classes_hidden'>"+WYMeditor.CLASSES_ITEMS+"</ul>"+"</li>"+"</ul>",classesItemHtml:"<li><a href='#' name='"+WYMeditor.CLASS_NAME+"'>"+WYMeditor.CLASS_TITLE+"</a></li>",classesItemHtmlMultiple:"<li class='wym_tools_class_multiple_rules'><span>"+WYMeditor.CLASS_TITLE+"</span>"+"<ul>{classesItemHtml}</ul>"+"</li>",containersHtml:"<ul class='wym_containers wym_section'>"+WYMeditor.CONTAINERS_ITEMS+"</ul>",containersItemHtml:"<li class='"+WYMeditor.CONTAINER_CLASS+"'>"+"<a href='#' name='"+WYMeditor.CONTAINER_NAME+"' title='"+WYMeditor.CONTAINER_TITLE+"' class='no-tooltip'></a>"+"</li>",boxHtml:"<div class='wym_box'><div class='wym_area_top clearfix'>"+WYMeditor.CONTAINERS+WYMeditor.TOOLS+WYMeditor.CLASSES+"</div>"+"<div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div>"+"</div>",iframeHtml:"<div class='wym_iframe wym_section'><iframe id='WYMeditor_"+WYMeditor.INDEX+"'"+($.browser.msie?" src='"+WYMeditor.IFRAME_BASE_PATH+"wymiframe'":"")+" frameborder='0' marginheight='0' marginwidth='0' border='0'"+" onload='this.contentWindow.parent.WYMeditor.INSTANCES["+WYMeditor.INDEX+"].loadIframe(this);'></iframe>"+"</div>",dialogImageHtml:"",dialogLinkHtml:"",dialogTableHtml:"<div class='wym_dialog wym_dialog_table'><form><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_TABLE+"' />"+"<div class='field'>"+"<label for='wym_caption'>{Caption}</label>"+"<input type='text' id='wym_caption' class='wym_caption' value='' size='40' />"+"</div>"+"<div class='field'>"+"<label for='wym_rows'>{Number_Of_Rows}</label>"+"<input type='text' id='wym_rows' class='wym_rows' value='3' size='3' />"+"</div>"+"<div class='field'>"+"<label for='wym_cols'>{Number_Of_Cols}</label>"+"<input type='text' id='wym_cols' class='wym_cols' value='2' size='3' />"+"</div>"+form_actions+"</form>"+"</div>",dialogPasteHtml:"<div class='wym_dialog wym_dialog_paste'><form><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_PASTE+"' />"+"<div class='field'>"+"<textarea class='wym_text' rows='10' cols='50'></textarea>"+"</div>"+form_actions+"</form>"+"</div>",dialogPath:"/refinery/dialogs/",dialogFeatures:{width:866,height:455,modal:!0,draggable:!0,resizable:!1,autoOpen:!0,open:onOpenDialog,close:onCloseDialog},dialogInlineFeatures:{width:600,height:485,modal:!0,draggable:!0,resizable:!1,autoOpen:!0,open:onOpenDialog,close:onCloseDialog},dialogId:"editor_dialog",dialogHtml:"<!DOCTYPE html><html dir='"+WYMeditor.DIRECTION+"'>"+"<head>"+"<link rel='stylesheet' type='text/css' media='screen' href='"+WYMeditor.CSS_PATH+"' />"+"<title>"+WYMeditor.DIALOG_TITLE+"</title>"+"<script type='text/javascript' src='"+WYMeditor.JQUERY_PATH+"'></script>"+"<script type='text/javascript' src='"+WYMeditor.WYM_PATH+"'></script>"+"</head>"+"<body>"+"<div id='page'>"+WYMeditor.DIALOG_BODY+"</div>"+"</body>"+"</html>",postInit:function(e){wymeditors_loaded+=1;if(WYMeditor.INSTANCES.length==wymeditors_loaded){$(".wym_loading_overlay").remove();for(i=0;i<WYMeditor.onload_functions.length;i++)WYMeditor.onload_functions[i]()}$(e._iframe).contents().find("body").addClass("wym_iframe_body"),$(".field.hide-overflow").removeClass("hide-overflow").css("height","auto")},postInitDialog:function(e){$.browser.msie&&($the_ui_dialog=$(".ui-dialog")).css("height",$the_ui_dialog.find("iframe").height()+$the_ui_dialog.find("iframe").contents().find(".form-actions").height()-12)},lang:"en"},custom_wymeditor_boot_options);WYMeditor.editor.prototype.loadIframe=function(e){var t=this,n=e.contentDocument||e.contentWindow;n.document&&(n=n.document);if(!$.browser.msie){n.open("text/html","replace"),html="<!DOCTYPE html>    <html>      <head>        <title>WYMeditor</title>        <meta charset='"+$("meta[charset]").attr("charset")+"' />        <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1' />      </head>      <body class='wym_iframe'>      </body>    </html>",n.write(html),n.close();var r=n.head||$(n).find("head").get(0);$("<link href='/assets/wymeditor/skins/refinery/wymiframe-55387bbd2356a4122ffc1dd590ac7220.css' media='all' rel='stylesheet' />").appendTo(r),$("<link href='/assets/formatting-037f6c052bac1730923b5f755b8197f7.css' media='all' rel='stylesheet' />").appendTo(r),$("<link href='/assets/theme-41ea2610dbfeaecb7120d44e2a7d3035.css' media='all' rel='stylesheet' />").appendTo(r)}(id_of_editor=t._element.parent().attr("id"))!=null&&$(n.body).addClass(id_of_editor),t.initIframe(e)},WYMeditor.init=function(){wymeditor_inputs=$(".wymeditor").filter(function(e){for(i=0;i<WYMeditor.INSTANCES.length;i++)if(WYMeditor.INSTANCES[i]._element.attr("id")==$(this).attr("id"))return!1;return!0}),wymeditor_inputs.each(function(e){(containing_field=$(this).parents(".field")).length>0&&containing_field.get(0).style.height.replace("auto","")===""&&containing_field.addClass("hide-overflow").css("height",$(this).outerHeight()-containing_field.offset().top+$(this).offset().top+45),$(this).hide()}),wymeditor_inputs.wymeditor(wymeditor_boot_options)},$(function(){WYMeditor.init()});